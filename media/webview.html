<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MultiAgent Swarm</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --vscode-bg: #ffffff;
            --vscode-fg: #2d3748;
            --vscode-border: #e2e8f0;
            --vscode-hover: #f7fafc;
            --vscode-active: #edf2f7;
            --accent-blue: #3182ce;
            --accent-purple: #805ad5;
            --accent-green: #38a169;
            --accent-orange: #dd6b20;
            --accent-red: #e53e3e;
            --gradient-primary: linear-gradient(135deg, #667eea, #764ba2);
            --gradient-secondary: linear-gradient(135deg, #38a169, #3182ce);
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(226, 232, 240, 0.8);
            --shadow: rgba(0, 0, 0, 0.04);
            --shadow-hover: rgba(0, 0, 0, 0.08);
            --text-muted: #718096;
            --text-light: #a0aec0;
            
            /* Additional theme-aware variables */
            --input-bg: #f9fafb;
            --input-border: #e5e7eb;
            --input-focus-border: #3b82f6;
            --button-bg: #f9fafb;
            --button-border: #e5e7eb;
            --button-hover-bg: #f3f4f6;
            --button-hover-border: #d1d5db;
            --card-bg: #ffffff;
            --dropdown-bg: #ffffff;
            --message-bg: #ffffff;
            --message-gradient: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            --user-message-gradient: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            --chat-messages-bg: #fafbfc;
            --body-bg: #fafbfc;
        }

        [data-theme="dark"] {
            --vscode-bg: #1e1e1e;
            --vscode-fg: #cccccc;
            --vscode-border: #333333;
            --vscode-hover: #2a2a2a;
            --vscode-active: #37373d;
            --accent-blue: #60a5fa;
            --accent-purple: #a78bfa;
            --accent-green: #34d399;
            --accent-orange: #fbbf24;
            --accent-red: #f87171;
            --gradient-primary: linear-gradient(135deg, #7c3aed, #1e40af);
            --gradient-secondary: linear-gradient(135deg, #059669, #1d4ed8);
            --glass-bg: rgba(30, 30, 30, 0.95);
            --glass-border: rgba(51, 51, 51, 0.8);
            --shadow: rgba(0, 0, 0, 0.3);
            --shadow-hover: rgba(0, 0, 0, 0.4);
            --text-muted: #9ca3af;
            --text-light: #6b7280;
            
            /* Dark theme specific variables */
            --input-bg: #2d2d2d;
            --input-border: #404040;
            --input-focus-border: #60a5fa;
            --button-bg: #2d2d2d;
            --button-border: #404040;
            --button-hover-bg: #3a3a3a;
            --button-hover-border: #525252;
            --card-bg: #252525;
            --dropdown-bg: #252525;
            --message-bg: #252525;
            --message-gradient: linear-gradient(135deg, #252525 0%, #2d2d2d 100%);
            --user-message-gradient: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            --chat-messages-bg: #1a1a1a;
            --body-bg: #1a1a1a;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: var(--body-bg);
            color: var(--vscode-fg);
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        .main-container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        /* Floating Sidebar - Proper width */
        .floating-sidebar {
            position: fixed;
            left: 20px;
            top: 20px;
            bottom: 20px;
            width: 380px;
            background: var(--card-bg);
            border: 1px solid var(--vscode-border);
            border-radius: 12px;
            box-shadow: 0 4px 24px var(--shadow);
            z-index: 50;
            display: flex;
            flex-direction: column;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateX(0);
            overflow: hidden;
        }

        .floating-sidebar.collapsed {
            width: 0px;
            transform: translateX(-100%);
            opacity: 0;
            pointer-events: none;
        }

        /* Sidebar content with proper scrolling and bottom padding */
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            max-height: calc(100vh - 160px);
            padding-bottom: 12px;
        }

        .sidebar-content::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .sidebar-content::-webkit-scrollbar-thumb {
            background: var(--vscode-scrollbarSlider-background);
            border-radius: 3px;
        }

        .sidebar-content::-webkit-scrollbar-thumb:hover {
            background: var(--vscode-scrollbarSlider-hoverBackground);
        }

        .sidebar-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--vscode-border);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px 12px 0 0;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .sidebar-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(118, 75, 162, 0.9));
            backdrop-filter: blur(10px);
        }

        .sidebar-header-content {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
            font-size: 18px;
            font-weight: 700;
            transition: all 0.3s ease;
            position: relative;
            flex: 1;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .floating-sidebar.collapsed .logo {
            gap: 0;
            justify-content: center;
            margin-bottom: 0;
        }

        .floating-sidebar.collapsed .header-top {
            justify-content: center;
        }

        .floating-sidebar.collapsed .header-controls {
            display: none;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .floating-sidebar.collapsed .logo-icon {
            width: 24px;
            height: 24px;
            font-size: 12px;
        }

        .logo-text {
            transition: all 0.3s ease;
            font-weight: 700;
        }

        .floating-sidebar.collapsed .logo-text {
            opacity: 0;
            transform: scale(0.8);
            width: 0;
            overflow: hidden;
        }

        .logo-subtitle {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 400;
            transition: all 0.3s ease;
        }

        .floating-sidebar.collapsed .logo-subtitle {
            opacity: 0;
            height: 0;
            margin: 0;
            overflow: hidden;
        }

        .floating-sidebar.collapsed .sidebar-header-content {
            gap: 8px;
        }

        .swarm-selector {
            position: relative;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .floating-sidebar.collapsed .swarm-selector {
            display: flex;
            justify-content: center;
            padding-top: 8px;
        }

        .floating-sidebar.collapsed .swarm-dropdown-menu {
            display: none !important;
            visibility: hidden !important;
        }

        .swarm-dropdown {
            width: 100%;
            background: var(--dropdown-bg);
            border: 1px solid var(--input-border);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--vscode-fg);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 14px;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .swarm-dropdown::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .swarm-dropdown:hover::before {
            opacity: 1;
        }

        .dropdown-text {
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--vscode-fg);
        }

        .dropdown-text::before {
            content: '';
            margin-right: 4px;
        }

        .floating-sidebar.collapsed .swarm-dropdown {
            width: 24px;
            height: 24px;
            padding: 0;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .floating-sidebar.collapsed .swarm-dropdown .dropdown-text {
            display: none;
        }

        .floating-sidebar.collapsed .swarm-dropdown .dropdown-arrow {
            font-size: 10px;
        }

        .swarm-dropdown:hover {
            background: var(--button-hover-bg);
            border-color: var(--button-hover-border);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--shadow-hover);
        }

        .floating-sidebar.collapsed .swarm-dropdown:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .dropdown-arrow {
            position: relative;
            z-index: 1;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 12px;
            opacity: 0.6;
            color: var(--text-muted);
        }

        .swarm-dropdown:hover .dropdown-arrow {
            opacity: 1;
            transform: scale(1.1);
        }

        .swarm-dropdown-menu.show ~ .swarm-dropdown .dropdown-arrow {
            transform: rotate(180deg) scale(1.1);
            opacity: 1;
        }

        /* Dropdown Menu */
        .swarm-dropdown-menu {
            position: fixed;
            background: var(--dropdown-bg);
            border: 1px solid var(--vscode-border);
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px var(--shadow), 0 10px 10px -5px var(--shadow-hover);
            z-index: 10000;
            opacity: 0;
            transform: translateY(-15px) scale(0.95);
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 340px;
            overflow: hidden;
            padding: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .swarm-dropdown-menu::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.01), rgba(0, 0, 0, 0.005));
            border-radius: 12px;
        }

        .swarm-dropdown-menu.show {
            opacity: 1;
            transform: translateY(0) scale(1);
            visibility: visible;
            animation: dropdownSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes dropdownSlideIn {
            0% {
                opacity: 0;
                transform: translateY(-15px) scale(0.95);
            }
            50% {
                opacity: 0.8;
                transform: translateY(-5px) scale(0.98);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .swarm-dropdown-option {
            padding: 16px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--vscode-fg);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 12px;
            margin-bottom: 4px;
            position: relative;
            display: flex;
            align-items: center;
            gap: 14px;
            z-index: 1;
            background: transparent;
            border: 1px solid transparent;
        }

        .swarm-icon {
            font-size: 14px;
            font-weight: 700;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            border-radius: 8px;
            text-align: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .swarm-icon.flutter-icon {
            background: linear-gradient(135deg, #02569B 0%, #0277BD 100%);
        }

        .swarm-icon.web-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .swarm-icon.mobile-icon {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .swarm-icon.ai-icon {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .swarm-icon.data-icon {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }

        .swarm-icon.python-icon {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        }

        .swarm-icon.custom-icon {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }

        .swarm-icon.create-icon {
            background: var(--accent-blue);
        }

        .swarm-name {
            flex: 1;
            font-weight: 500;
            color: var(--vscode-fg);
            line-height: 1.4;
        }

        .swarm-dropdown-option::before {
            content: '';
            position: absolute;
            right: 12px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-blue);
            opacity: 0;
            transition: all 0.2s ease;
        }

        .swarm-dropdown-option:hover {
            background: var(--vscode-hover);
            color: var(--vscode-fg);
            transform: translateX(2px);
        }

        .swarm-dropdown-option:hover .swarm-icon {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .swarm-dropdown-option:hover::before {
            opacity: 1;
            background: #10b981;
            transform: scale(1.2);
        }

        .swarm-dropdown-option.selected {
            background: var(--vscode-active);
            color: var(--accent-blue);
            border: 1px solid var(--accent-blue);
        }

        .swarm-dropdown-option.selected::before {
            opacity: 1;
            background: var(--accent-blue);
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.3);
        }

        .swarm-dropdown-option.selected .swarm-icon {
            transform: scale(1.1);
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-blue) 100%);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .swarm-dropdown-option:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .swarm-dropdown-separator {
            height: 1px;
            background: var(--vscode-border);
            margin: 8px 0;
            opacity: 0.5;
        }

        .swarm-dropdown-option.create-swarm {
            color: var(--accent-blue);
            font-weight: 500;
        }

        .swarm-dropdown-option.create-swarm:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 197, 253, 0.05) 100%);
            color: var(--accent-blue);
        }

        .swarm-dropdown-option.create-swarm .swarm-icon {
            background: var(--accent-blue);
            color: white;
        }

        .swarm-dropdown-option.create-swarm:hover .swarm-icon {
            background: var(--accent-blue);
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .swarm-dropdown-option.ai-generate {
            color: var(--accent-purple);
            font-weight: 500;
        }

        .swarm-dropdown-option.ai-generate:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(147, 51, 234, 0.05) 100%);
            color: var(--accent-purple);
        }

        .swarm-dropdown-option.ai-generate .swarm-icon {
            background: var(--accent-purple);
            color: white;
        }

        .swarm-dropdown-option.ai-generate:hover .swarm-icon {
            background: var(--accent-purple);
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        /* Theme Toggle */
        .sidebar-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--vscode-border);
            background: var(--card-bg);
            border-radius: 0 0 12px 12px;
            transition: all 0.3s ease;
        }

        /* Collaboration Section - Properly spaced */
        .collaboration-section {
            margin: 10px 16px 14px 16px;
            padding: 12px;
            background: var(--card-bg);
            border: 1px solid var(--vscode-border);
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .collaboration-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            border-radius: 8px 8px 0 0;
        }

        .collaboration-section:hover {
            box-shadow: 0 2px 8px var(--shadow-hover);
            border-color: var(--accent-blue);
        }

        .collaboration-title {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 0;
            font-size: 13px;
            font-weight: 600;
            color: var(--vscode-fg);
            cursor: pointer;
            padding: 2px 0;
        }

        .collaboration-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 6px;
            font-size: 11px;
        }

        .collapse-toggle-btn {
            margin-left: auto;
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            color: var(--text-muted);
            cursor: pointer;
            padding: 3px 6px;
            border-radius: 4px;
            transition: all 0.2s ease;
            font-size: 11px;
            min-width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .collapse-toggle-btn:hover {
            background: var(--button-hover-bg);
            border-color: var(--accent-blue);
            color: var(--vscode-fg);
        }

        .collaboration-content {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            margin-top: 12px;
        }

        .collaboration-content.collapsed {
            max-height: 0;
            margin-top: 0;
            opacity: 0;
        }

        .swarm-collaboration-info {
            margin-bottom: 10px;
            padding: 8px 12px;
            background: linear-gradient(135deg, var(--input-bg), rgba(99, 102, 241, 0.05));
            border-radius: 6px;
            border-left: 3px solid var(--accent-blue);
        }

        .current-swarm-indicator {
            font-size: 11px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .current-swarm-indicator strong {
            color: var(--accent-blue);
            font-weight: 600;
        }

        .collaboration-textarea {
            width: 100%;
            min-height: 80px;
            max-height: 120px;
            padding: 12px;
            background: var(--input-bg);
            border: 2px solid var(--input-border);
            border-radius: 6px;
            color: var(--vscode-fg);
            font-family: var(--vscode-font-family);
            font-size: 12px;
            line-height: 1.4;
            resize: vertical;
            transition: all 0.2s ease;
        }

        .collaboration-textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.1);
            background: var(--vscode-bg);
        }

        .collaboration-textarea::placeholder {
            color: var(--text-muted);
            opacity: 0.7;
        }

        .collaboration-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            justify-content: flex-end;
        }

        .collaboration-btn {
            padding: 6px 12px;
            background: var(--button-bg);
            border: 1px solid var(--button-border);
            border-radius: 6px;
            color: var(--vscode-fg);
            cursor: pointer;
            font-size: 11px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .collaboration-btn:hover {
            background: var(--button-hover-bg);
            border-color: var(--accent-blue);
        }

        .collaboration-btn.primary {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            color: white;
            font-weight: 600;
        }

        .collaboration-btn.primary:hover {
            background: #5a67d8;
            border-color: #5a67d8;
        }

        /* Agents Section - Improved spacing after collaboration */
        /* Agents Section - Properly spaced */
        .agents-section {
            margin: 8px 16px 14px 16px;
            padding: 0;
        }

        .agents-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            padding: 0 2px;
        }

        .agents-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--vscode-fg);
            margin: 0;
        }

        .agents-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--accent-purple), #9f7aea);
            border-radius: 6px;
            font-size: 11px;
            color: white;
        }

        .add-agent-btn {
            margin-left: auto;
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            color: var(--text-muted);
            cursor: pointer;
            padding: 3px 6px;
            border-radius: 4px;
            transition: all 0.2s ease;
            font-size: 11px;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .add-agent-btn:hover {
            background: var(--button-hover-bg);
            border-color: var(--accent-purple);
            color: var(--vscode-fg);
        }

        .agent-card {
            margin-bottom: 8px;
            padding: 10px 14px;
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 6px;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
            border-left: 3px solid var(--vscode-border);
        }

        .agent-card:last-child {
            margin-bottom: 4px;
        }

        .agent-card.active {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.05));
            border-left-color: var(--accent-blue);
            border-color: var(--accent-blue);
        }

        .agent-card:hover {
            background: var(--card-bg);
            border-color: var(--accent-purple);
            border-left-color: var(--accent-purple);
            transform: translateX(2px);
        }

        .agent-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 6px;
        }

        .agent-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--vscode-fg);
            margin: 0;
            flex: 1;
        }

        .agent-status {
            width: 8px;
            height: 8px;
            background: var(--accent-green);
            border-radius: 50%;
            margin-left: auto;
            box-shadow: 0 0 0 2px rgba(72, 187, 120, 0.2);
        }

        .agent-status.offline {
            background: var(--text-muted);
            box-shadow: 0 0 0 2px rgba(128, 128, 128, 0.2);
        }

        .agent-description {
            color: var(--text-muted);
            font-size: 12px;
            line-height: 1.3;
            margin: 0;
        }

        .agent-tools {
            display: flex;
            gap: 6px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .agent-tool {
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            color: var(--text-muted);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
        }

        .agent-avatar {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            color: white;
        }

        /* Input section enhanced spacing */
        .input-section {
            margin: 24px 20px 20px 20px;
            padding: 0;
        }

        .input-section textarea {
            margin-bottom: 16px;
        }

        .input-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .send-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--accent-blue), #5a67d8);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 3px 12px rgba(99, 102, 241, 0.3);
            position: relative;
            overflow: hidden;
        }

        .send-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .send-btn:hover::before {
            left: 100%;
        }

        .send-btn:hover {
            background: linear-gradient(135deg, #5a67d8, #4c51bf);
            box-shadow: 0 5px 20px rgba(99, 102, 241, 0.4);
            transform: translateY(-2px);
        }

        .send-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        }

        /* Section spacing improvements */
        .section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        /* Activity Logs Section - Properly spaced */
        .activity-section {
            margin: 14px 16px 10px 16px;
            padding: 12px;
            background: var(--card-bg);
            border: 1px solid var(--vscode-border);
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
        }

        .activity-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-green), #48bb78);
            border-radius: 8px 8px 0 0;
        }

        .activity-section:hover {
            border-color: var(--accent-green);
        }

        .activity-title {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 0;
            font-size: 13px;
            font-weight: 600;
            color: var(--vscode-fg);
            cursor: pointer;
            padding: 2px 0;
        }

        .activity-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--accent-green), #48bb78);
            border-radius: 6px;
            font-size: 11px;
            color: white;
        }

        .activity-logs {
            margin-top: 12px;
            max-height: 150px;
            min-height: 80px;
            overflow-y: auto;
            padding: 10px;
            background: var(--input-bg);
            border-radius: 6px;
            border: 1px solid var(--input-border);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .activity-logs.collapsed {
            max-height: 0;
            margin-top: 0;
            padding: 0 10px;
            opacity: 0;
            border-width: 0;
        }

        .activity-logs::-webkit-scrollbar {
            width: 6px;
        }

        .activity-logs::-webkit-scrollbar-track {
            background: transparent;
        }

        .activity-logs::-webkit-scrollbar-thumb {
            background: var(--accent-green);
            border-radius: 3px;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 8px 10px;
            background: var(--vscode-bg);
            border-radius: 6px;
            border-left: 3px solid var(--accent-green);
            transition: all 0.2s ease;
        }

        .log-entry:last-child {
            margin-bottom: 0;
        }

        .log-entry:hover {
            background: var(--card-bg);
            transform: translateX(1px);
        }

        .log-timestamp {
            font-size: 10px;
            color: var(--text-muted);
            margin-bottom: 4px;
            font-weight: 500;
        }

        .log-message {
            font-size: 12px;
            color: var(--vscode-fg);
            line-height: 1.3;
            margin: 0;
        }

        /* Empty state for activity logs */
        .empty-logs {
            text-align: center;
            padding: 20px 12px;
            color: var(--text-muted);
            font-style: italic;
            font-size: 12px;
        }

        .empty-logs::before {
            content: '📝';
            display: block;
            font-size: 20px;
            margin-bottom: 6px;
            opacity: 0.6;
        }

        /* Enhanced visual hierarchy */
        .floating-sidebar.collapsed .collaboration-section {
            display: none;
        }

        .floating-sidebar.collapsed .sidebar-footer {
            display: none;
        }

        .theme-toggle-container {
            position: relative;
        }

        .theme-toggle-btn {
            width: 100%;
            height: 44px;
            background: var(--button-bg);
            border: 1px solid var(--button-border);
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--vscode-fg);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .theme-toggle-btn:hover {
            background: var(--button-hover-bg);
            border-color: var(--button-hover-border);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--shadow-hover);
        }

        .theme-icon {
            font-size: 16px;
        }

        .theme-label {
            flex: 1;
            text-align: left;
        }

        .floating-sidebar.collapsed .header-controls {
            display: none;
        }

        .collapse-btn {
            position: relative;
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 4px;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 10px;
        }

        .theme-dropdown-menu {
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            background: var(--dropdown-bg);
            border: 1px solid var(--vscode-border);
            border-radius: 12px;
            box-shadow: 0 -8px 24px var(--shadow-hover);
            z-index: 10001;
            opacity: 0;
            transform: translateY(10px) scale(0.95);
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 8px;
            padding: 8px;
            min-width: 140px;
            backdrop-filter: blur(8px);
        }

        .theme-dropdown-menu.show {
            opacity: 1;
            transform: translateY(0) scale(1);
            visibility: visible;
        }

        .theme-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--vscode-fg);
            font-size: 13px;
            font-weight: 500;
            position: relative;
            background: transparent;
            border: 1px solid transparent;
            margin-bottom: 2px;
        }

        .theme-option:hover {
            background: var(--vscode-hover);
            border-color: var(--vscode-border);
            color: var(--vscode-fg);
            transform: scale(1.02);
        }

        .theme-option-icon {
            font-size: 14px;
            width: 16px;
            text-align: center;
        }

        .theme-option-text {
            flex: 1;
        }

        .theme-option-check {
            color: var(--accent-blue);
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .theme-option.selected {
            background: var(--vscode-active);
            border-color: var(--accent-blue);
            color: var(--vscode-fg);
        }

        .theme-option.selected .theme-option-check {
            opacity: 1;
            color: var(--accent-blue);
        }

        /* Expand Icon for Collapsed Sidebar */
        .sidebar-expand-icon {
            position: absolute;
            left: -50px;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            background: var(--vscode-button-background);
            border: 1px solid var(--vscode-button-border);
            border-radius: 6px;
            color: var(--vscode-button-foreground);
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 99;
            font-size: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .sidebar-expand-icon:hover {
            background: var(--vscode-button-hoverBackground);
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .floating-sidebar.collapsed + .main-content .sidebar-expand-icon {
            display: flex;
        }

        .collapse-btn:hover {
            background: rgba(255, 255, 255, 0.12);
            color: white;
        }

        .floating-sidebar.collapsed .collapse-btn {
            position: absolute;
            top: 20px;
            right: 18px;
            width: 20px;
            height: 20px;
            font-size: 8px;
        }

        .agents-section {
            flex: 1;
            padding: 20px;
            padding-top: 24px;
            padding-bottom: 0;
            overflow-y: auto;
            transition: all 0.3s ease;
        }

        .floating-sidebar.collapsed .agents-section {
            padding: 12px 8px;
            opacity: 0;
            pointer-events: none;
        }

        .section-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .add-agent-btn {
            width: 24px;
            height: 24px;
            background: var(--vscode-fg);
            border: none;
            border-radius: 6px;
            color: var(--card-bg);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .add-agent-btn:hover {
            background: var(--accent-blue);
            transform: scale(1.1);
            box-shadow: 0 4px 12px var(--shadow-hover);
        }

        .agent-card {
            background: var(--card-bg);
            border: 1px solid var(--vscode-border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .agent-card:first-child {
            margin-top: 8px;
        }

        .agent-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent-blue);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .agent-card:hover {
            border-color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px var(--shadow-hover);
        }

        .agent-card.active {
            border-color: var(--accent-blue);
            background: var(--vscode-active);
        }

        .agent-card.active::before {
            opacity: 1;
        }

        .agent-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .agent-name {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
        }

        .agent-avatar {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .agent-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-green);
            position: relative;
        }

        .agent-status.active::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid var(--accent-green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }

        .agent-tools {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .agent-actions {
            display: flex;
            gap: 4px;
            margin-top: 8px;
        }

        .agent-action-btn {
            background: var(--button-bg);
            border: 1px solid var(--button-border);
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 10px;
            color: var(--vscode-fg);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 3px;
            transition: all 0.2s ease;
            flex: 1;
            justify-content: center;
        }

        .agent-action-btn:hover {
            background: var(--button-hover-bg);
            border-color: var(--button-hover-border);
            transform: translateY(-1px);
        }

        .agent-action-btn span:first-child {
            font-size: 11px;
        }

        .agent-action-btn span:last-child {
            font-weight: 500;
        }

        /* Activity Logs */
        .activity-logs {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 4px;
        }

        .activity-logs::-webkit-scrollbar {
            width: 4px;
        }

        .activity-logs::-webkit-scrollbar-track {
            background: var(--vscode-border);
            border-radius: 2px;
        }

        .activity-logs::-webkit-scrollbar-thumb {
            background: var(--text-muted);
            border-radius: 2px;
        }

        .log-entry {
            background: var(--card-bg);
            border: 1px solid var(--vscode-border);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
            position: relative;
        }

        .log-entry:hover {
            border-color: var(--accent-blue);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--shadow-hover);
        }

        .log-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .log-avatar {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
        }

        .log-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .log-agent {
            font-size: 11px;
            font-weight: 600;
            color: var(--vscode-fg);
        }

        .log-time {
            font-size: 9px;
            color: var(--text-muted);
        }

        .log-content {
            font-size: 11px;
            color: var(--text-muted);
            line-height: 1.4;
            margin-bottom: 6px;
        }

        .log-status {
            font-size: 9px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 10px;
            display: inline-block;
        }

        .log-status.success {
            background: rgba(56, 161, 105, 0.2);
            color: var(--accent-green);
        }

        .log-status.modified {
            background: rgba(128, 90, 213, 0.2);
            color: var(--accent-purple);
        }

        .log-status.coordinating {
            background: rgba(49, 130, 206, 0.2);
            color: var(--accent-blue);
        }

        /* Main Content Area - Proper spacing */
        .main-content {
            flex: 1;
            margin-left: 420px;
            margin-right: 20px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .main-content.sidebar-collapsed {
            margin-left: 20px;
        }

        .main-header {
            background: var(--card-bg);
            border: 1px solid var(--vscode-border);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 16px;
            position: relative;
        }

        .main-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--vscode-fg);
        }

        .main-subtitle {
            color: var(--text-muted);
            font-size: 13px;
        }

        .content-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
            background: var(--card-bg);
            border: 1px solid var(--vscode-border);
            border-radius: 6px;
            padding: 4px;
        }

        .tab-button {
            padding: 8px 16px;
            background: transparent;
            border: none;
            border-radius: 6px;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 13px;
        }

        .tab-button.active {
            background: var(--vscode-fg);
            color: var(--card-bg);
        }

        .tab-button:hover:not(.active) {
            background: var(--vscode-hover);
            color: var(--vscode-fg);
        }

        .tab-content {
            display: none;
            flex: 1;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
        }

        /* Chat Interface - Better space utilization */
        .chat-container {
            background: var(--card-bg);
            border: 1px solid var(--vscode-border);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 160px);
            overflow: hidden;
            position: relative;
            box-shadow: 0 4px 16px var(--shadow);
            width: 100%;
        }

        .chat-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--vscode-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card-bg);
            border-radius: 16px 16px 0 0;
        }

        .chat-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--vscode-fg);
        }

        .agent-title-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            color: white;
        }

        .multi-agent-icon {
            display: flex;
            align-items: center;
            gap: -4px;
            position: relative;
        }

        .agent-mini-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            color: white;
            border: 2px solid var(--vscode-bg);
            position: relative;
            z-index: 1;
        }

        .agent-mini-avatar:nth-child(2) {
            margin-left: -8px;
            z-index: 2;
        }

        .agent-mini-avatar:nth-child(3) {
            margin-left: -8px;
            z-index: 3;
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-muted);
        }

        .status-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-green);
        }

        .chat-messages {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            scroll-behavior: smooth;
            background: var(--chat-messages-bg);
            border-radius: 0;
        }

        .message {
            margin-bottom: 20px;
            animation: messageSlideIn 0.3s ease-out;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-bubble {
            background: var(--message-bg);
            border: 1px solid var(--vscode-border);
            border-radius: 16px;
            padding: 16px 20px;
            position: relative;
            max-width: 100%;
            box-shadow: 0 2px 8px var(--shadow);
            transition: all 0.2s ease;
        }

        .message-bubble:hover {
            box-shadow: 0 4px 12px var(--shadow-hover);
            transform: translateY(-1px);
        }

        .message.agent .message-bubble {
            margin-left: 0;
            background: var(--message-gradient);
            border: 1px solid var(--vscode-border);
        }

        .message.user .message-bubble {
            margin-left: auto;
            background: var(--user-message-gradient);
            color: white;
            border: 1px solid transparent;
            border-radius: 16px;
            max-width: 75%;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-muted);
        }

        .message-avatar {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            font-weight: 600;
            color: white;
        }

        .message-content {
            line-height: 1.6;
            font-size: 14px;
            color: var(--vscode-fg);
        }

        .message.user .message-content {
            color: white;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 16px 20px;
            background: var(--message-gradient);
            border: 1px solid var(--vscode-border);
            border-radius: 16px;
            margin-bottom: 20px;
            max-width: 200px;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: var(--text-muted);
            border-radius: 50%;
            animation: typingPulse 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingPulse {
            0%, 80%, 100% {
                opacity: 0.3;
                transform: scale(0.8);
            }
            40% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .chat-input-container {
            padding: 16px 20px;
            border-top: 1px solid var(--vscode-border);
            background: var(--card-bg);
            border-radius: 0 0 16px 16px;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 12px;
            padding: 14px 16px;
            color: var(--vscode-fg);
            font-size: 14px;
            resize: none;
            min-height: 44px;
            max-height: 120px;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--input-focus-border);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            background: var(--card-bg);
        }

        .send-button {
            background: var(--user-message-gradient);
            border: none;
            border-radius: 12px;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: white;
            font-size: 16px;
            flex-shrink: 0;
        }

        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px var(--shadow-hover);
        }

        .send-button:disabled {
            background: var(--input-border);
            color: var(--text-muted);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Configuration Tab */
        .config-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: calc(100vh - 200px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 24px;
            padding-right: 20px;
            background: var(--chat-messages-bg);
            scroll-behavior: smooth;
            position: relative;
        }

        .config-section {
            background: var(--card-bg);
            border: 1px solid var(--vscode-border);
            border-radius: 12px;
            box-shadow: 0 2px 8px var(--shadow);
            overflow: visible;
            transition: all 0.2s ease;
            min-height: 80px;
            flex-shrink: 0;
        }

        .config-section:hover {
            box-shadow: 0 4px 12px var(--shadow-hover);
        }

        .config-section-header {
            padding: 20px 24px;
            background: var(--card-bg);
            border-bottom: 1px solid var(--vscode-border);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.2s ease;
            position: relative;
        }

        .config-section-header:hover {
            background: var(--vscode-hover);
        }

        .config-section-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            font-weight: 600;
            flex-shrink: 0;
        }

        .config-section-icon.basic {
            background: linear-gradient(135deg, #007acc, #0056a3);
        }

        .config-section-icon.collaboration {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .config-section-icon.advanced {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .config-section-details {
            flex: 1;
        }

        .config-section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--vscode-fg);
            margin-bottom: 4px;
            line-height: 1.2;
        }

        .config-section-subtitle {
            font-size: 13px;
            color: var(--vscode-descriptionForeground);
            font-weight: 400;
            line-height: 1.3;
        }

        .config-section-toggle {
            margin-left: auto;
            font-size: 14px;
            color: var(--vscode-descriptionForeground);
            transition: transform 0.2s ease;
        }

        .config-section.collapsed .config-section-toggle {
            transform: rotate(-90deg);
        }

        .config-section-content {
            padding: 0;
            background: var(--card-bg);
            overflow: visible;
            transition: all 0.3s ease;
            opacity: 1;
            max-height: none;
        }

        .config-section.collapsed .config-section-content {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }

        .form-group {
            margin-bottom: 20px;
            padding: 18px 24px;
            border-bottom: 1px solid var(--vscode-border);
            transition: all 0.2s ease;
        }

        .form-group:last-child {
            border-bottom: none;
        }

        .form-group:hover {
            background: var(--vscode-hover);
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--vscode-fg);
            margin-bottom: 8px;
        }

        .form-input, .form-textarea {
            width: 100%;
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--vscode-fg);
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--input-focus-border);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Tools Tab */
        .tools-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: calc(100vh - 200px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 24px;
            padding-right: 20px;
            background: var(--chat-messages-bg);
            scroll-behavior: smooth;
            position: relative;
        }

        .tools-container::before {
            content: '';
            position: sticky;
            top: 0;
            height: 0;
            background: linear-gradient(to bottom, var(--vscode-bg) 0%, transparent 100%);
            z-index: 1;
            pointer-events: none;
        }

        .tools-container::after {
            content: '';
            position: sticky;
            bottom: 0;
            height: 0;
            background: linear-gradient(to top, var(--vscode-bg) 0%, transparent 100%);
            z-index: 1;
            pointer-events: none;
        }

        .tools-section {
            background: var(--card-bg);
            border: 1px solid var(--vscode-border);
            border-radius: 8px;
            box-shadow: 0 2px 8px var(--shadow);
            overflow: visible;
            transition: all 0.2s ease;
            min-height: 80px;
            flex-shrink: 0;
        }

        .tools-section:hover {
            box-shadow: 0 4px 12px var(--shadow-hover);
        }

        .section-header {
            padding: 20px 24px;
            background: var(--card-bg);
            border-bottom: 1px solid var(--vscode-border);
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .section-header:hover {
            background: var(--vscode-hover);
        }

        .section-toggle {
            margin-left: auto;
            font-size: 14px;
            color: var(--vscode-descriptionForeground);
            transition: transform 0.2s ease;
        }

        .tools-section.collapsed .section-toggle {
            transform: rotate(-90deg);
        }

        .section-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            font-weight: 600;
            flex-shrink: 0;
        }

        .section-icon.development {
            background: linear-gradient(135deg, #007acc, #0056a3);
        }

        .section-icon.management {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .section-icon.testing {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .section-icon.deployment {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .section-details {
            flex: 1;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--vscode-fg);
            margin-bottom: 4px;
            line-height: 1.2;
        }

        .section-subtitle {
            font-size: 13px;
            color: var(--vscode-descriptionForeground);
            font-weight: 400;
            line-height: 1.3;
        }

        .tools-content {
            padding: 0;
            background: var(--card-bg);
            overflow: visible;
            transition: all 0.3s ease;
            opacity: 1;
            max-height: none;
        }

        .tools-section.collapsed .tools-content {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }

        .tool-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px 24px;
            border-bottom: 1px solid var(--vscode-border);
            transition: all 0.2s ease;
        }

        .tool-option:last-child {
            border-bottom: none;
        }

        .tool-option:hover {
            background: var(--vscode-hover);
        }

        .tool-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .tool-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-green);
            flex-shrink: 0;
        }

        .tool-details {
            flex: 1;
        }

        .tool-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--vscode-fg);
            margin-bottom: 4px;
            line-height: 1.2;
        }

        .tool-description {
            font-size: 12px;
            color: var(--vscode-descriptionForeground);
            line-height: 1.4;
            margin: 0;
        }

        .tool-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: var(--input-border);
            border: 1px solid var(--input-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: var(--vscode-fg);
            border-color: var(--vscode-fg);
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(20px);
        }

        .toggle-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-muted);
            min-width: 50px;
            text-align: left;
        }

        .toggle-switch.active + .toggle-label {
            color: var(--vscode-fg);
        }

        .tool-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .delete-tool-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 6px;
            border-radius: 4px;
            transition: all 0.2s ease;
            font-size: 14px;
            opacity: 0.7;
        }

        .delete-tool-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            opacity: 1;
            transform: scale(1.1);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border: 1px solid var(--vscode-border);
            border-radius: 16px;
            padding: 32px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px var(--shadow-hover);
        }

        .modal-content.agent-modal {
            max-width: 700px;
            width: 95%;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--vscode-fg);
        }

        .close-button {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .close-button:hover {
            color: var(--vscode-fg);
            background: var(--vscode-hover);
        }

        .modal-header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .add-tool-btn {
            background: var(--accent-blue);
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .add-tool-btn:hover {
            background: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        /* AI-specific styles */
        .ai-info-box {
            display: flex;
            align-items: center;
            gap: 16px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(147, 51, 234, 0.05) 100%);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .ai-info-icon {
            font-size: 32px;
            flex-shrink: 0;
        }

        .ai-info-content h4 {
            margin: 0 0 8px 0;
            color: var(--accent-purple);
            font-weight: 600;
        }

        .ai-info-content p {
            margin: 0;
            color: var(--text-muted);
            font-size: 14px;
            line-height: 1.5;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.2s ease;
        }

        .checkbox-item:hover {
            background: var(--vscode-hover);
        }

        .checkbox-item input[type="checkbox"] {
            display: none;
        }

        .checkmark {
            width: 18px;
            height: 18px;
            border: 2px solid var(--input-border);
            border-radius: 4px;
            position: relative;
            transition: all 0.2s ease;
        }

        .checkbox-item input[type="checkbox"]:checked + .checkmark {
            background: var(--accent-purple);
            border-color: var(--accent-purple);
        }

        .checkbox-item input[type="checkbox"]:checked + .checkmark::after {
            content: '✓';
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .ai-generation-status {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .ai-status-icon {
            font-size: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .ai-status-text {
            color: var(--accent-blue);
            font-weight: 500;
        }

        .ai-button {
            background: linear-gradient(135deg, var(--accent-purple) 0%, #7c3aed 100%);
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .ai-button:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        .ai-button-icon {
            font-size: 16px;
        }

        .ai-assist-btn {
            background: linear-gradient(135deg, var(--accent-purple) 0%, #7c3aed 100%);
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .ai-assist-btn:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .ai-assist-btn.active {
            background: linear-gradient(135deg, #6d28d9 0%, #5b21b6 100%);
        }

        .ai-assist-panel {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(147, 51, 234, 0.02) 100%);
            border: 1px solid rgba(139, 92, 246, 0.15);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .ai-assist-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            color: var(--accent-purple);
            font-weight: 600;
        }

        .ai-assist-icon {
            font-size: 18px;
        }

        .ai-generate-tool-btn {
            background: linear-gradient(135deg, var(--accent-purple) 0%, #7c3aed 100%);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            justify-content: center;
        }

        .ai-generate-tool-btn:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        /* AI Suggestions */
        .ai-suggestions {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
            border: 1px solid rgba(59, 130, 246, 0.15);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .suggestions-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            color: var(--accent-blue);
            font-weight: 600;
            font-size: 14px;
        }

        .suggestions-icon {
            font-size: 16px;
        }

        .refresh-suggestions-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
            margin-left: auto;
        }

        .refresh-suggestions-btn:hover {
            background: rgba(59, 130, 246, 0.1);
            color: var(--accent-blue);
            transform: rotate(180deg);
        }

        .suggestions-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .suggestion-chip {
            background: var(--card-bg);
            border: 1px solid var(--input-border);
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 13px;
            color: var(--vscode-fg);
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }

        .suggestion-chip:hover {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        /* AI Context Features */
        .ai-context-btn {
            background: var(--button-bg);
            border: 1px solid var(--button-border);
            border-radius: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-muted);
            margin-left: 8px;
        }

        .ai-context-btn:hover {
            background: var(--button-hover-bg);
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            transform: translateY(-1px);
        }

        .ai-context-btn.active {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            color: white;
        }

        .chat-context-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 6px;
            padding: 8px 12px;
            margin-top: 8px;
            font-size: 13px;
            color: var(--accent-blue);
        }

        .context-icon {
            font-size: 14px;
        }

        .context-text {
            flex: 1;
        }

        .remove-context-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 2px;
            border-radius: 3px;
            transition: all 0.2s ease;
        }

        .remove-context-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .primary-button {
            background: var(--user-message-gradient);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
        }

        .primary-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--shadow-hover);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .floating-sidebar {
                width: 280px;
            }
            
            .main-content {
                margin-left: 320px;
            }
            
            .main-content.sidebar-collapsed {
                margin-left: 20px;
            }
        }

        @media (max-width: 768px) {
            .floating-sidebar {
                left: 10px;
                top: 10px;
                bottom: 10px;
                width: 260px;
            }
            
            .main-content {
                margin-left: 280px;
                padding: 10px;
            }
            
            .main-content.sidebar-collapsed {
                margin-left: 10px;
            }
            
            .tools-grid {
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
                gap: 16px;
                padding: 20px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--vscode-scrollbarSlider-background);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--vscode-scrollbarSlider-hoverBackground);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--vscode-scrollbarSlider-activeBackground);
        }

        /* Enhanced scrollbar for tools container */
        .tools-container::-webkit-scrollbar {
            width: 12px;
        }

        .tools-container::-webkit-scrollbar-track {
            background: var(--vscode-scrollbarSlider-background);
            border-radius: 6px;
        }

        .tools-container::-webkit-scrollbar-thumb {
            background: var(--vscode-scrollbarSlider-hoverBackground);
            border-radius: 6px;
            border: 2px solid var(--vscode-bg);
        }

        .tools-container::-webkit-scrollbar-thumb:hover {
            background: var(--vscode-scrollbarSlider-activeBackground);
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Floating Sidebar -->
        <div class="floating-sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-header-content">
                    <div class="header-top">
                        <div class="logo">
                            <div class="logo-icon">🤖</div>
                            <span class="logo-text" id="logoText">MultiAgenticSwarm</span>
                        </div>
                        <div class="header-controls">
                            <!-- Collapse Button -->
                            <button class="collapse-btn" onclick="toggleSidebar()" title="Collapse">
                                <span id="collapseIcon">◀</span>
                            </button>
                        </div>
                    </div>
                    <div class="logo-subtitle">AI Development Assistant</div>
                    <div class="swarm-selector" id="swarmSelector">
                        <div class="swarm-dropdown" onclick="toggleSwarmDropdown()">
                            <span class="dropdown-text" id="selectedSwarm"><span class="swarm-icon python-icon" style="margin-right: 8px; width: 20px; height: 20px; font-size: 12px;">P</span>PythonSwarm</span>
                            <span class="dropdown-arrow">▼</span>
                        </div>
                        <div class="swarm-dropdown-menu" id="swarmDropdownMenu">
                            <div class="swarm-dropdown-option" onclick="selectSwarm('PythonSwarm')" data-icon="🐍">
                                <span class="swarm-icon python-icon">P</span>
                                <span class="swarm-name">PythonSwarm</span>
                            </div>
                            <div class="swarm-dropdown-option" onclick="selectSwarm('FlutterSwarm')" data-icon="📱">
                                <span class="swarm-icon flutter-icon">F</span>
                                <span class="swarm-name">FlutterSwarm</span>
                            </div>
                            <div class="swarm-dropdown-option" onclick="selectSwarm('WebDevSwarm')" data-icon="🌐">
                                <span class="swarm-icon web-icon">W</span>
                                <span class="swarm-name">WebDevSwarm</span>
                            </div>
                            <div class="swarm-dropdown-option" onclick="selectSwarm('MobileSwarm')" data-icon="📲">
                                <span class="swarm-icon mobile-icon">M</span>
                                <span class="swarm-name">MobileSwarm</span>
                            </div>
                            <div class="swarm-dropdown-option" onclick="selectSwarm('AISwarm')" data-icon="🧠">
                                <span class="swarm-icon ai-icon">A</span>
                                <span class="swarm-name">AISwarm</span>
                            </div>
                            <div class="swarm-dropdown-option" onclick="selectSwarm('DataSwarm')" data-icon="📊">
                                <span class="swarm-icon data-icon">D</span>
                                <span class="swarm-name">DataSwarm</span>
                            </div>
                            <div class="swarm-dropdown-option" onclick="selectSwarm('PythonSwarm')" data-icon="🐍">
                                <span class="swarm-icon python-icon">P</span>
                                <span class="swarm-name">PythonSwarm</span>
                            </div>
                            <div class="swarm-dropdown-separator"></div>
                            <div class="swarm-dropdown-option ai-generate" onclick="closeSwarmDropdown(); openModal('aiGenerateSwarmModal')" data-icon="🤖">
                                <span class="swarm-icon ai-generate-icon">🤖</span>
                                <span class="swarm-name">AI Generate Swarm</span>
                            </div>
                            <div class="swarm-dropdown-option create-swarm" onclick="closeSwarmDropdown(); openModal('createSwarmModal')" data-icon="➕">
                                <span class="swarm-icon create-icon">+</span>
                                <span class="swarm-name">Create Custom Swarm</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scrollable Content Container -->
            <div class="sidebar-content">
                <!-- Enhanced Collaboration Section - Positioned for optimal UX flow -->
            <div class="collaboration-section">
                <div class="collaboration-title" onclick="toggleCollaborationSection()">
                    <div class="collaboration-icon">🤝</div>
                    <span>Swarm Collaboration</span>
                    <button class="collapse-toggle-btn" id="collaborationToggle">−</button>
                </div>
                <div class="collaboration-content" id="collaborationContent">
                    <div class="swarm-collaboration-info">
                        <span class="current-swarm-indicator">Current: <strong id="currentSwarmCollabName">PythonSwarm</strong></span>
                    </div>
                    <textarea 
                        class="collaboration-textarea" 
                        id="globalCollaborationRules"
                        placeholder="Define how agents in this swarm should collaborate together. For example:&#10;&#10;• Orchestrator receives requests and delegates to specialists&#10;• Python Developer handles backend implementation&#10;• Frontend Developer creates user interfaces&#10;• QA Tester validates all implementations&#10;• All agents provide status updates and coordinate handoffs"
                        onchange="updateSwarmCollaboration(this.value)"
                    >Orchestrator Agent: Coordinates all project activities, delegates tasks to specialized agents, monitors progress, and consolidates final results.

Python Developer: Implements backend logic, database models, APIs, and server-side functionality. Reports progress to Orchestrator.

Frontend Developer: Creates user interfaces, implements responsive design, and integrates with backend APIs. Coordinates with Python Developer for seamless integration.

QA Tester: Validates all implementations, runs comprehensive test suites, identifies issues, and ensures quality standards. Reports findings to development team and Orchestrator.</textarea>
                    <div class="collaboration-actions">
                        <button class="collaboration-btn primary" onclick="saveSwarmCollaborationRules()">Save Rules</button>
                        <button class="collaboration-btn" onclick="resetSwarmCollaborationRules()">Reset to Default</button>
                    </div>
                </div>
            </div>

            <div class="agents-section">
                <div class="agents-header">
                    <div class="agents-icon">🤖</div>
                    <h3 class="agents-title">Active Agents</h3>
                    <button class="add-agent-btn" onclick="openModal('newAgentModal')" title="Add New Agent">+</button>
                </div>

                <div id="agentsList">
                    <div class="agent-card active" data-agent="orchestrator">
                        <div class="agent-header" onclick="selectAgent(this.parentElement, 'orchestrator')">
                            <div class="agent-avatar" style="background: var(--gradient-primary);">O</div>
                            <div class="agent-name">Orchestrator Agent</div>
                            <div class="agent-status"></div>
                        </div>
                        <div class="agent-description">Coordinates project activities and delegates tasks</div>
                        <div class="agent-tools">
                            <div class="agent-tool">Config</div>
                            <div class="agent-tool">Tools</div>
                        </div>
                    </div>

                    <div class="agent-card" data-agent="python">
                        <div class="agent-header" onclick="selectAgent(this.parentElement, 'python')">
                            <div class="agent-avatar" style="background: var(--gradient-secondary);">P</div>
                            <div class="agent-name">Python Developer</div>
                            <div class="agent-status"></div>
                        </div>
                        <div class="agent-description">Backend logic, APIs, and server-side functionality</div>
                        <div class="agent-tools">
                            <div class="agent-tool">Config</div>
                            <div class="agent-tool">Tools</div>
                        </div>
                    </div>

                    <div class="agent-card" data-agent="frontend">
                        <div class="agent-header" onclick="selectAgent(this.parentElement, 'frontend')">
                            <div class="agent-avatar" style="background: linear-gradient(135deg, var(--accent-purple), var(--accent-red));">F</div>
                            <div class="agent-name">Frontend Developer</div>
                            <div class="agent-status"></div>
                        </div>
                        <div class="agent-description">User interfaces and responsive design</div>
                        <div class="agent-tools">
                            <div class="agent-tool">Config</div>
                            <div class="agent-tool">Tools</div>
                        </div>
                    </div>

                    <div class="agent-card" data-agent="qa">
                        <div class="agent-header" onclick="selectAgent(this.parentElement, 'qa')">
                            <div class="agent-avatar" style="background: linear-gradient(135deg, var(--accent-green), #48bb78);">Q</div>
                            <div class="agent-name">QA Tester</div>
                            <div class="agent-status"></div>
                        </div>
                        <div class="agent-description">Validates implementations and ensures quality</div>
                        <div class="agent-tools">
                            <div class="agent-tool">Config</div>
                            <div class="agent-tool">Tools</div>
                        </div>
                    </div>

                    <div class="agent-card" data-agent="writer">
                        <div class="agent-header" onclick="selectAgent(this.parentElement, 'writer')">
                            <div class="agent-name">
                                <div class="agent-avatar" style="background: linear-gradient(135deg, var(--accent-orange), var(--accent-red));">✍️</div>
                                <span>Writer Agent</span>
                            </div>
                            <div class="agent-status active"></div>
                        </div>
                        <div class="agent-tools">4 tools enabled</div>
                        <div class="agent-actions">
                            <button class="agent-action-btn" onclick="openAgentConfig('writer')" title="Configuration">
                                <span>⚙️</span>
                                <span>Config</span>
                            </button>
                            <button class="agent-action-btn" onclick="openAgentTools('writer')" title="Tools">
                                <span>🛠️</span>
                                <span>Tools</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Activity Logs Section -->
            <div class="activity-section">
                <div class="activity-title" onclick="toggleActivityLogsSection()">
                    <div class="activity-icon">📊</div>
                    <span>Activity Logs</span>
                    <button class="add-agent-btn" onclick="clearLogs()" title="Clear Logs">🗑️</button>
                    <button class="collapse-toggle-btn" id="activityToggle">−</button>
                </div>

                <div class="activity-logs" id="activityLogs">
                    <div class="empty-logs">No recent activity</div>
                </div>
            </div>
            </div> <!-- End scrollable content container -->
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <div class="main-header">
                <!-- Sidebar Expand Icon (shown when sidebar is collapsed) -->
                <div class="sidebar-expand-icon" onclick="toggleSidebar()" title="Expand Sidebar">
                    ▶
                </div>
                <h1 class="main-title" id="mainTitle">Multi-Agent Collaboration Hub</h1>
                <p class="main-subtitle">Interact with your AI agents in real-time</p>
            </div>

            <!-- Chat Interface (Primary Focus) -->
            <div class="chat-container">
                <div class="chat-header">
                    <div class="chat-title">
                        <div class="multi-agent-icon">
                            <div class="agent-mini-avatar" style="background: var(--gradient-primary);">O</div>
                            <div class="agent-mini-avatar" style="background: var(--gradient-secondary);">C</div>
                            <div class="agent-mini-avatar" style="background: linear-gradient(135deg, var(--accent-purple), var(--accent-red));">T</div>
                        </div>
                        <div>
                            <div style="font-size: 16px; font-weight: 600;">Multi-Agent Collaboration Hub</div>
                            <div style="font-size: 12px; color: var(--vscode-descriptionForeground); font-weight: normal;">Chat with all your AI agents in one unified space</div>
                        </div>
                    </div>
                    <div class="chat-status">
                        <div class="status-indicator"></div>
                        <span id="chatStatusText">4 agents online • Ready to collaborate</span>
                    </div>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <div class="message agent">
                        <div class="message-bubble">
                            <div class="message-header">
                                <div class="message-avatar" style="background: var(--gradient-primary);">🤖</div>
                                <span>System • 5:07:10 PM</span>
                            </div>
                            <div class="message-content">
                                Welcome to your Multi-Agent Collaboration Hub! All your agents are ready to work together on your tasks. Simply ask a question or request, and the appropriate agents will collaborate to provide the best solution.
                            </div>
                        </div>
                    </div>

                    <div class="message agent">
                        <div class="message-bubble">
                            <div class="message-header">
                                <div class="message-avatar" style="background: var(--accent-blue);">O</div>
                                <span>Orchestrator • 5:12:45 PM</span>
                            </div>
                            <div class="message-content">
                                I'll coordinate between all agents to handle your requests efficiently. The CI/CD Agent handles deployments, Tests Agent ensures quality, and I manage the overall workflow. How can we assist you today?
                            </div>
                        </div>
                    </div>
                </div>

                <div class="ai-suggestions" id="aiSuggestions">
                    <div class="suggestions-header">
                        <span class="suggestions-icon">💡</span>
                        <span>AI Suggestions</span>
                        <button class="refresh-suggestions-btn" onclick="generateAISuggestions()" title="Refresh suggestions">
                            <span>🔄</span>
                        </button>
                    </div>
                    <div class="suggestions-container" id="suggestionsContainer">
                        <div class="suggestion-chip" onclick="applySuggestion(this)">
                            Analyze current code structure
                        </div>
                        <div class="suggestion-chip" onclick="applySuggestion(this)">
                            Generate unit tests for main functions
                        </div>
                        <div class="suggestion-chip" onclick="applySuggestion(this)">
                            Review code for security issues
                        </div>
                        <div class="suggestion-chip" onclick="applySuggestion(this)">
                            Optimize performance bottlenecks
                        </div>
                    </div>
                </div>

                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <textarea 
                            class="chat-input" 
                            id="chatInput" 
                            placeholder="Ask your agents anything..."
                            rows="1"
                            onkeydown="handleChatKeydown(event)"
                            oninput="autoResizeTextarea(this)"
                        ></textarea>
                        <button class="send-button" onclick="sendMessage()" id="sendButton">
                            <span>↗</span>
                        </button>
                        <button class="ai-context-btn" onclick="addCodeContext()" id="aiContextBtn" title="Add current file context">
                            <span>📄</span>
                        </button>
                    </div>
                    <div class="chat-context-indicator" id="chatContextIndicator" style="display: none;">
                        <span class="context-icon">📄</span>
                        <span class="context-text">Current file context included</span>
                        <button class="remove-context-btn" onclick="removeCodeContext()">✕</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- New Agent Modal -->
    <div class="modal" id="newAgentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create New Agent</h3>
                <div class="modal-header-actions">
                    <button class="ai-assist-btn" onclick="toggleAgentAIAssist()" id="agentAiAssistBtn" title="AI Assistant">
                        <span>🤖</span>
                        AI Assist
                    </button>
                    <button class="close-button" onclick="closeModal('newAgentModal')">&times;</button>
                </div>
            </div>

            <div class="ai-assist-panel" id="agentAiAssistPanel" style="display: none;">
                <div class="ai-assist-header">
                    <span class="ai-assist-icon">🧠</span>
                    <span>AI Agent Generator</span>
                </div>
                <div class="form-group">
                    <label class="form-label">What should this agent specialize in?</label>
                    <textarea class="form-textarea" id="aiAgentRequest" placeholder="e.g., 'An agent that handles database operations and API integrations for e-commerce'"></textarea>
                </div>
                <button class="ai-generate-tool-btn" onclick="generateAgentWithAI()">
                    <span class="ai-button-icon">🤖</span>
                    Generate Agent Details
                </button>
                <div class="ai-generation-status" id="aiAgentGenerationStatus" style="display: none;">
                    <div class="ai-status-icon">🔄</div>
                    <div class="ai-status-text">Generating agent configuration...</div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Agent Name</label>
                <input type="text" class="form-input" id="newAgentName" placeholder="e.g., Database Agent">
            </div>

            <div class="form-group">
                <label class="form-label">Agent Role</label>
                <select class="form-input" id="newAgentRole">
                    <option value="general">General Purpose</option>
                    <option value="database">Database Management</option>
                    <option value="api">API Development</option>
                    <option value="ui">UI/UX Design</option>
                    <option value="security">Security</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">System Prompt</label>
                <textarea class="form-textarea" id="newAgentPrompt" placeholder="Describe the agent's role and capabilities..."></textarea>
            </div>

            <button class="primary-button" onclick="createNewAgent()">Create Agent</button>
        </div>
    </div>

    <!-- Agent Configuration Modal -->
    <div class="modal" id="agentConfigModal">
        <div class="modal-content agent-modal">
            <div class="modal-header">
                <h3 class="modal-title" id="configModalTitle">Agent Configuration</h3>
                <button class="close-button" onclick="closeModal('agentConfigModal')">&times;</button>
            </div>

            <div class="config-container" id="agentConfigContent">
                <!-- Configuration content will be dynamically populated -->
            </div>
        </div>
    </div>

    <!-- Agent Tools Modal -->
    <div class="modal" id="agentToolsModal">
        <div class="modal-content agent-modal">
            <div class="modal-header">
                <h3 class="modal-title" id="toolsModalTitle">Agent Tools</h3>
                <div class="modal-header-actions">
                    <button class="add-tool-btn" onclick="openModal('addToolModal')" title="Add Custom Tool">+ Add Tool</button>
                    <button class="close-button" onclick="closeModal('agentToolsModal')">&times;</button>
                </div>
            </div>

            <div class="tools-container" id="agentToolsContent">
                <!-- Tools content will be dynamically populated -->
            </div>
        </div>
    </div>

    <!-- Create Custom Swarm Modal -->
    <div class="modal" id="createSwarmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create Custom Swarm</h3>
                <button class="close-button" onclick="closeModal('createSwarmModal')">&times;</button>
            </div>

            <div class="form-group">
                <label class="form-label">Swarm Name</label>
                <input type="text" class="form-input" id="customSwarmName" placeholder="e.g., E-commerce Swarm">
            </div>

            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-textarea" id="customSwarmDescription" placeholder="Describe the purpose of this swarm..."></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">Template</label>
                <select class="form-input" id="customSwarmTemplate">
                    <option value="scratch">Start from Scratch</option>
                    <option value="web">Web Development Template</option>
                    <option value="mobile">Mobile Development Template</option>
                    <option value="data">Data Science Template</option>
                    <option value="ai">AI/ML Template</option>
                    <option value="api">API Development Template</option>
                </select>
            </div>

            <button class="primary-button" onclick="createCustomSwarm()">Create Swarm</button>
        </div>
    </div>

    <!-- Add Custom Tool Modal -->
    <div class="modal" id="addToolModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add Custom Tool</h3>
                <div class="modal-header-actions">
                    <button class="ai-assist-btn" onclick="toggleAIAssist()" id="aiAssistBtn" title="AI Assistant">
                        <span>🤖</span>
                        AI Assist
                    </button>
                    <button class="close-button" onclick="closeModal('addToolModal')">&times;</button>
                </div>
            </div>

            <div class="ai-assist-panel" id="aiAssistPanel" style="display: none;">
                <div class="ai-assist-header">
                    <span class="ai-assist-icon">🧠</span>
                    <span>AI Tool Generator</span>
                </div>
                <div class="form-group">
                    <label class="form-label">Describe what you want the tool to do</label>
                    <textarea class="form-textarea" id="aiToolRequest" placeholder="e.g., 'A tool that validates database connections and runs health checks'"></textarea>
                </div>
                <button class="ai-generate-tool-btn" onclick="generateToolWithAI()">
                    <span class="ai-button-icon">🤖</span>
                    Generate Tool Details
                </button>
                <div class="ai-generation-status" id="aiToolGenerationStatus" style="display: none;">
                    <div class="ai-status-icon">🔄</div>
                    <div class="ai-status-text">Generating tool details...</div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Tool Name</label>
                <input type="text" class="form-input" id="customToolName" placeholder="e.g., Database Query Tool">
            </div>

            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-textarea" id="customToolDescription" placeholder="Describe what this tool does and how it helps the agent..."></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">Tool Category</label>
                <select class="form-input" id="customToolCategory">
                    <option value="development">Development</option>
                    <option value="testing">Testing</option>
                    <option value="management">Management</option>
                    <option value="deployment">Deployment</option>
                    <option value="custom">Custom Category</option>
                </select>
            </div>

            <div class="form-group" id="customCategoryGroup" style="display: none;">
                <label class="form-label">Custom Category Name</label>
                <input type="text" class="form-input" id="customCategoryName" placeholder="e.g., Integration Tools">
            </div>

            <div class="form-group">
                <label class="form-label">Initial Status</label>
                <select class="form-input" id="customToolStatus">
                    <option value="false">Disabled</option>
                    <option value="true">Enabled</option>
                </select>
            </div>

            <button class="primary-button" onclick="addCustomTool()">Add Tool</button>
        </div>
    </div>

    <!-- AI Generate Swarm Modal -->
    <div class="modal" id="aiGenerateSwarmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">🤖 AI Generate Swarm</h3>
                <button class="close-button" onclick="closeModal('aiGenerateSwarmModal')">&times;</button>
            </div>

            <div class="ai-info-box">
                <div class="ai-info-icon">🧠</div>
                <div class="ai-info-content">
                    <h4>Smart Swarm Generation</h4>
                    <p>AI will analyze your project structure and create a customized swarm with relevant agents and tools.</p>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Project Type</label>
                <select class="form-input" id="aiProjectType">
                    <option value="auto">Auto-detect from workspace</option>
                    <option value="web-frontend">Web Frontend (React, Vue, Angular)</option>
                    <option value="web-backend">Web Backend (Node.js, Python, Java)</option>
                    <option value="mobile">Mobile App (React Native, Flutter)</option>
                    <option value="desktop">Desktop Application</option>
                    <option value="api">REST/GraphQL API</option>
                    <option value="microservices">Microservices Architecture</option>
                    <option value="data-science">Data Science/ML Project</option>
                    <option value="devops">DevOps/Infrastructure</option>
                    <option value="game">Game Development</option>
                    <option value="blockchain">Blockchain/Web3</option>
                    <option value="other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Project Description (Optional)</label>
                <textarea class="form-textarea" id="aiProjectDescription" placeholder="Describe your project goals, tech stack, or specific requirements..."></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">Focus Areas</label>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" id="focus-development" checked>
                        <span class="checkmark"></span>
                        Development & Coding
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="focus-testing">
                        <span class="checkmark"></span>
                        Testing & QA
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="focus-deployment">
                        <span class="checkmark"></span>
                        Deployment & CI/CD
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="focus-monitoring">
                        <span class="checkmark"></span>
                        Monitoring & Analytics
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="focus-security">
                        <span class="checkmark"></span>
                        Security & Compliance
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="focus-documentation">
                        <span class="checkmark"></span>
                        Documentation
                    </label>
                </div>
            </div>

            <div class="ai-generation-status" id="aiGenerationStatus" style="display: none;">
                <div class="ai-status-icon">🔄</div>
                <div class="ai-status-text">Analyzing project and generating swarm...</div>
            </div>

            <button class="primary-button ai-button" onclick="generateSwarmWithAI()" id="generateSwarmBtn">
                <span class="ai-button-icon">🤖</span>
                Generate Swarm with AI
            </button>
        </div>
    </div>

    <script>
        const vscode = acquireVsCodeApi();

        // Global state
        let currentAgent = 'orchestrator';
        let sidebarCollapsed = false;
        let currentTab = 'chat';
        let isTyping = false;

        // Agent data with specific tools and configurations
        const agents = {
            orchestrator: {
                name: 'Orchestrator Agent',
                avatar: 'O',
                gradient: 'var(--gradient-primary)',
                tools: 5,
                enabledTools: ['task-delegation', 'progress-tracking', 'resource-allocation', 'workflow-management', 'agent-coordination'],
                toolSections: {
                    'development': {
                        title: 'Development',
                        subtitle: 'Code analysis, dependency management, and development utilities',
                        icon: '💻',
                        tools: [
                            { id: 'code-analysis', name: 'Code Analysis', description: 'Analyzes code for best practices and potential issues', enabled: false },
                            { id: 'dependency-resolution', name: 'Dependency Resolution', description: 'Manages package dependencies and resolves conflicts', enabled: false }
                        ]
                    },
                    'testing': {
                        title: 'Testing',
                        subtitle: 'Quality assurance and validation tools',
                        icon: '🧪',
                        tools: [
                            { id: 'test-coordination', name: 'Test Coordination', description: 'Coordinates testing activities across agents', enabled: false },
                            { id: 'quality-gates', name: 'Quality Gates', description: 'Enforces quality standards before deployments', enabled: false }
                        ]
                    },
                    'management': {
                        title: 'Management',
                        subtitle: 'Task delegation, coordination, and project oversight tools',
                        icon: '⚙️',
                        tools: [
                            { id: 'task-delegation', name: 'Task Delegation', description: 'Intelligently delegates tasks to appropriate specialized agents', enabled: true },
                            { id: 'progress-tracking', name: 'Progress Tracking', description: 'Monitors and reports on task completion status across all agents', enabled: true },
                            { id: 'resource-allocation', name: 'Resource Allocation', description: 'Optimizes resource distribution and workload balancing', enabled: true },
                            { id: 'workflow-management', name: 'Workflow Management', description: 'Manages complex workflows and dependencies between tasks', enabled: true },
                            { id: 'agent-coordination', name: 'Agent Coordination', description: 'Coordinates communication and collaboration between agents', enabled: true }
                        ]
                    },
                    'deployment': {
                        title: 'Deployment',
                        subtitle: 'Release coordination and deployment oversight',
                        icon: '�',
                        tools: [
                            { id: 'deployment-coordination', name: 'Deployment Coordination', description: 'Coordinates deployment activities across environments', enabled: false },
                            { id: 'release-oversight', name: 'Release Oversight', description: 'Oversees release processes and approvals', enabled: false }
                        ]
                    }
                },
                config: {
                    systemPrompt: 'You are an orchestrator agent responsible for coordinating tasks between different agents in the development workflow.',
                    llmProvider: 'openai-gpt4',
                    responseTimeout: 5000,
                    maxConcurrentTasks: 5,
                    memoryManagement: 'auto'
                }
            },
            cicd: {
                name: 'CI/CD Agent',
                avatar: 'C',
                gradient: 'var(--gradient-secondary)',
                tools: 4,
                enabledTools: ['build-pipeline', 'release-management', 'deployment-automation', 'environment-sync'],
                toolSections: {
                    'development': {
                        title: 'Development',
                        subtitle: 'Build optimization and development support',
                        icon: '�',
                        tools: [
                            { id: 'build-optimization', name: 'Build Optimization', description: 'Optimizes build processes and reduces compilation time', enabled: false },
                            { id: 'code-integration', name: 'Code Integration', description: 'Manages continuous integration workflows', enabled: false }
                        ]
                    },
                    'testing': {
                        title: 'Testing',
                        subtitle: 'Automated testing and validation in CI/CD pipeline',
                        icon: '🧪',
                        tools: [
                            { id: 'automated-testing', name: 'Automated Testing', description: 'Runs automated tests in the CI/CD pipeline', enabled: false },
                            { id: 'smoke-testing', name: 'Smoke Testing', description: 'Performs quick validation after deployments', enabled: false }
                        ]
                    },
                    'management': {
                        title: 'Management',
                        subtitle: 'Pipeline and process management',
                        icon: '⚙️',
                        tools: [
                            { id: 'pipeline-management', name: 'Pipeline Management', description: 'Manages CI/CD pipeline configurations and workflows', enabled: false },
                            { id: 'process-monitoring', name: 'Process Monitoring', description: 'Monitors build and deployment processes', enabled: false }
                        ]
                    },
                    'deployment': {
                        title: 'Deployment',
                        subtitle: 'Build automation, deployment pipelines, and release management',
                        icon: '�',
                        tools: [
                            { id: 'build-pipeline', name: 'Build Pipeline', description: 'Manages automated build processes for multiple platforms', enabled: true },
                            { id: 'release-management', name: 'Release Management', description: 'Coordinates release cycles and deployment strategies', enabled: true },
                            { id: 'deployment-automation', name: 'Deployment Automation', description: 'Automates deployment to various environments', enabled: true },
                            { id: 'environment-sync', name: 'Environment Sync', description: 'Synchronizes configurations across environments', enabled: true }
                        ]
                    }
                },
                config: {
                    systemPrompt: 'You are a CI/CD agent specialized in build automation, deployment pipelines, and release management.',
                    llmProvider: 'openai-gpt4',
                    responseTimeout: 8000,
                    maxConcurrentTasks: 3,
                    memoryManagement: 'conservative'
                }
            },
            tests: {
                name: 'Tests Agent',
                avatar: 'T',
                gradient: 'linear-gradient(135deg, var(--accent-purple), var(--accent-red))',
                tools: 3,
                enabledTools: ['automated-testing', 'performance-testing', 'test-reporting'],
                toolSections: {
                    'development': {
                        title: 'Development',
                        subtitle: 'Development-time testing and code quality',
                        icon: '💻',
                        tools: [
                            { id: 'unit-testing', name: 'Unit Testing', description: 'Generates and runs unit tests during development', enabled: false },
                            { id: 'code-coverage', name: 'Code Coverage', description: 'Tracks and reports code coverage metrics', enabled: false }
                        ]
                    },
                    'testing': {
                        title: 'Testing',
                        subtitle: 'Comprehensive testing and quality assurance tools',
                        icon: '🧪',
                        tools: [
                            { id: 'automated-testing', name: 'Automated Testing', description: 'Automatically generates and runs comprehensive test suites', enabled: true },
                            { id: 'performance-testing', name: 'Performance Testing', description: 'Runs performance benchmarks and identifies bottlenecks', enabled: true },
                            { id: 'test-reporting', name: 'Test Reporting', description: 'Generates comprehensive test reports and analytics', enabled: true },
                            { id: 'regression-testing', name: 'Regression Testing', description: 'Ensures new changes don\'t break existing functionality', enabled: false }
                        ]
                    },
                    'management': {
                        title: 'Management',
                        subtitle: 'Test management and coordination',
                        icon: '⚙️',
                        tools: [
                            { id: 'test-planning', name: 'Test Planning', description: 'Plans and organizes testing strategies and schedules', enabled: false },
                            { id: 'defect-tracking', name: 'Defect Tracking', description: 'Tracks and manages identified defects and issues', enabled: false }
                        ]
                    },
                    'deployment': {
                        title: 'Deployment',
                        subtitle: 'Deployment validation and production testing',
                        icon: '🚀',
                        tools: [
                            { id: 'deployment-validation', name: 'Deployment Validation', description: 'Validates deployments in staging and production', enabled: false },
                            { id: 'production-monitoring', name: 'Production Monitoring', description: 'Monitors application health in production', enabled: false }
                        ]
                    }
                },
                config: {
                    systemPrompt: 'You are a testing agent specialized in automated testing, quality assurance, and code validation.',
                    llmProvider: 'claude',
                    responseTimeout: 6000,
                    maxConcurrentTasks: 4,
                    memoryManagement: 'aggressive'
                }
            },
            writer: {
                name: 'Writer Agent',
                avatar: '✍️',
                gradient: 'linear-gradient(135deg, var(--accent-orange), var(--accent-red))',
                tools: 4,
                enabledTools: ['content-generation', 'documentation', 'style-adaptation', 'grammar-checking'],
                toolSections: {
                    'content': {
                        title: 'Content Creation',
                        subtitle: 'Generate various types of written content',
                        icon: '📝',
                        tools: [
                            { id: 'content-generation', name: 'Content Generation', description: 'Creates blogs, articles, and marketing copy', enabled: true },
                            { id: 'copywriting', name: 'Copywriting', description: 'Writes persuasive marketing and sales content', enabled: false },
                            { id: 'creative-writing', name: 'Creative Writing', description: 'Produces creative stories and narratives', enabled: false }
                        ]
                    },
                    'documentation': {
                        title: 'Documentation',
                        subtitle: 'Technical and user documentation',
                        icon: '📚',
                        tools: [
                            { id: 'documentation', name: 'Documentation', description: 'Creates comprehensive technical documentation', enabled: true },
                            { id: 'api-docs', name: 'API Documentation', description: 'Generates API reference documentation', enabled: false },
                            { id: 'user-guides', name: 'User Guides', description: 'Creates user-friendly guides and tutorials', enabled: false }
                        ]
                    },
                    'editing': {
                        title: 'Editing & Style',
                        subtitle: 'Content refinement and style adaptation',
                        icon: '✨',
                        tools: [
                            { id: 'style-adaptation', name: 'Style Adaptation', description: 'Adapts content tone and style for different audiences', enabled: true },
                            { id: 'grammar-checking', name: 'Grammar Checking', description: 'Reviews and corrects grammar and syntax', enabled: true },
                            { id: 'proofreading', name: 'Proofreading', description: 'Final review and polish of written content', enabled: false }
                        ]
                    },
                    'analysis': {
                        title: 'Content Analysis',
                        subtitle: 'Content performance and optimization',
                        icon: '📊',
                        tools: [
                            { id: 'readability', name: 'Readability Analysis', description: 'Analyzes content readability and accessibility', enabled: false },
                            { id: 'seo-optimization', name: 'SEO Optimization', description: 'Optimizes content for search engines', enabled: false }
                        ]
                    }
                },
                config: {
                    systemPrompt: 'You are a professional writer agent specialized in creating clear, engaging, and well-structured content. Write in a professional, informative tone suitable for technical audiences.',
                    llmProvider: 'openai-gpt4',
                    responseTimeout: 4000,
                    maxConcurrentTasks: 3,
                    memoryManagement: 'auto'
                }
            },
            python_dev: {
                name: 'Python Developer',
                avatar: '🐍',
                gradient: 'linear-gradient(135deg, #3776ab, #ffd43b)',
                tools: 6,
                enabledTools: ['flask-framework', 'sqlite-database', 'python-templating', 'file-management', 'web-development', 'error-handling'],
                toolSections: {
                    'development': {
                        title: 'Python Development',
                        subtitle: 'Core Python development and web frameworks',
                        icon: '🐍',
                        tools: [
                            { id: 'flask-framework', name: 'Flask Framework', description: 'Creates web applications using Flask framework', enabled: true },
                            { id: 'django-framework', name: 'Django Framework', description: 'Builds applications with Django framework', enabled: false },
                            { id: 'fastapi-framework', name: 'FastAPI Framework', description: 'Develops APIs using FastAPI', enabled: false },
                            { id: 'python-templating', name: 'Python Templating', description: 'Creates Jinja2 templates and HTML rendering', enabled: true },
                            { id: 'web-development', name: 'Web Development', description: 'Full-stack Python web development', enabled: true }
                        ]
                    },
                    'database': {
                        title: 'Database',
                        subtitle: 'Database management and ORM',
                        icon: '🗄️',
                        tools: [
                            { id: 'sqlite-database', name: 'SQLite Database', description: 'Manages SQLite databases and queries', enabled: true },
                            { id: 'sqlalchemy-orm', name: 'SQLAlchemy ORM', description: 'Object-relational mapping with SQLAlchemy', enabled: false },
                            { id: 'database-migration', name: 'Database Migration', description: 'Handles database schema migrations', enabled: false }
                        ]
                    },
                    'utilities': {
                        title: 'Utilities',
                        subtitle: 'File management and error handling',
                        icon: '🛠️',
                        tools: [
                            { id: 'file-management', name: 'File Management', description: 'Handles file operations and structure', enabled: true },
                            { id: 'error-handling', name: 'Error Handling', description: 'Implements robust error handling and logging', enabled: true },
                            { id: 'code-organization', name: 'Code Organization', description: 'Structures and organizes Python projects', enabled: false }
                        ]
                    }
                },
                config: {
                    systemPrompt: 'You are a Python developer agent specialized in creating web applications, managing databases, and building robust Python applications. Focus on Flask web development, SQLite databases, and clean code architecture.',
                    llmProvider: 'openai-gpt4',
                    responseTimeout: 5000,
                    maxConcurrentTasks: 4,
                    memoryManagement: 'auto'
                }
            },
            frontend_dev: {
                name: 'Frontend Developer',
                avatar: '🎨',
                gradient: 'linear-gradient(135deg, #61dafb, #21759b)',
                tools: 5,
                enabledTools: ['html-css', 'javascript', 'responsive-design', 'ui-components', 'form-handling'],
                toolSections: {
                    'styling': {
                        title: 'Styling & Design',
                        subtitle: 'CSS, responsive design, and UI components',
                        icon: '🎨',
                        tools: [
                            { id: 'html-css', name: 'HTML & CSS', description: 'Creates semantic HTML and responsive CSS', enabled: true },
                            { id: 'responsive-design', name: 'Responsive Design', description: 'Builds mobile-first responsive layouts', enabled: true },
                            { id: 'ui-components', name: 'UI Components', description: 'Designs reusable UI components', enabled: true },
                            { id: 'css-frameworks', name: 'CSS Frameworks', description: 'Implements Bootstrap, Tailwind CSS', enabled: false }
                        ]
                    },
                    'interaction': {
                        title: 'User Interaction',
                        subtitle: 'JavaScript and form handling',
                        icon: '⚡',
                        tools: [
                            { id: 'javascript', name: 'JavaScript', description: 'Implements interactive functionality with vanilla JS', enabled: true },
                            { id: 'form-handling', name: 'Form Handling', description: 'Creates and validates interactive forms', enabled: true },
                            { id: 'dom-manipulation', name: 'DOM Manipulation', description: 'Dynamic content updates and event handling', enabled: false }
                        ]
                    },
                    'optimization': {
                        title: 'Performance',
                        subtitle: 'Frontend optimization and best practices',
                        icon: '⚡',
                        tools: [
                            { id: 'performance-optimization', name: 'Performance Optimization', description: 'Optimizes frontend performance and loading', enabled: false },
                            { id: 'accessibility', name: 'Accessibility', description: 'Ensures WCAG compliance and accessibility', enabled: false }
                        ]
                    }
                },
                config: {
                    systemPrompt: 'You are a frontend developer agent specialized in creating beautiful, responsive, and interactive user interfaces. Focus on HTML, CSS, JavaScript, and modern web design principles.',
                    llmProvider: 'claude',
                    responseTimeout: 4500,
                    maxConcurrentTasks: 3,
                    memoryManagement: 'auto'
                }
            },
            qa_tester: {
                name: 'QA Tester',
                avatar: '🧪',
                gradient: 'linear-gradient(135deg, #10b981, #059669)',
                tools: 4,
                enabledTools: ['unit-testing', 'integration-testing', 'manual-testing', 'bug-reporting'],
                toolSections: {
                    'testing': {
                        title: 'Automated Testing',
                        subtitle: 'Unit and integration testing',
                        icon: '🤖',
                        tools: [
                            { id: 'unit-testing', name: 'Unit Testing', description: 'Creates comprehensive unit tests with pytest', enabled: true },
                            { id: 'integration-testing', name: 'Integration Testing', description: 'Tests component integration and API endpoints', enabled: true },
                            { id: 'test-coverage', name: 'Test Coverage', description: 'Analyzes and improves test coverage', enabled: false }
                        ]
                    },
                    'validation': {
                        title: 'Manual Testing',
                        subtitle: 'User experience and functionality testing',
                        icon: '👤',
                        tools: [
                            { id: 'manual-testing', name: 'Manual Testing', description: 'Performs manual testing and usability validation', enabled: true },
                            { id: 'user-acceptance', name: 'User Acceptance Testing', description: 'Validates user requirements and acceptance criteria', enabled: false },
                            { id: 'cross-browser', name: 'Cross-browser Testing', description: 'Tests compatibility across different browsers', enabled: false }
                        ]
                    },
                    'reporting': {
                        title: 'Quality Assurance',
                        subtitle: 'Bug tracking and quality reports',
                        icon: '📋',
                        tools: [
                            { id: 'bug-reporting', name: 'Bug Reporting', description: 'Documents and tracks bugs with detailed reports', enabled: true },
                            { id: 'quality-metrics', name: 'Quality Metrics', description: 'Tracks quality metrics and improvement areas', enabled: false }
                        ]
                    }
                },
                config: {
                    systemPrompt: 'You are a QA tester agent specialized in ensuring application quality through comprehensive testing. Focus on automated testing with pytest, manual testing procedures, and detailed bug reporting.',
                    llmProvider: 'claude',
                    responseTimeout: 4000,
                    maxConcurrentTasks: 3,
                    memoryManagement: 'auto'
                }
            }
        };

        // Swarm configurations - defines which agents appear for each swarm
        const swarmConfigurations = {
            'WebDevSwarm': ['orchestrator', 'cicd', 'tests', 'writer'],
            'FlutterSwarm': ['orchestrator', 'cicd', 'tests'],
            'MobileSwarm': ['orchestrator', 'cicd', 'tests'],
            'AISwarm': ['orchestrator', 'cicd', 'tests', 'writer'],
            'DataSwarm': ['orchestrator', 'cicd', 'tests', 'writer'],
            'PythonSwarm': ['orchestrator', 'python_dev', 'frontend_dev', 'qa_tester']
        };

        let currentSwarm = 'PythonSwarm';

        function renderAgentsForSwarm(swarmName) {
            console.log('DEBUG: renderAgentsForSwarm called with:', swarmName);
            const agentsList = document.getElementById('agentsList');
            const agentIds = swarmConfigurations[swarmName] || swarmConfigurations['WebDevSwarm'];
            
            console.log('DEBUG: agentIds for', swarmName, ':', agentIds);
            console.log('DEBUG: agentsList element:', agentsList);
            
            // Clear current agents
            agentsList.innerHTML = '';
            
            // Render agents for this swarm
            agentIds.forEach((agentId, index) => {
                const agent = agents[agentId];
                console.log('DEBUG: Processing agent', agentId, ':', agent);
                if (!agent) {
                    console.log('DEBUG: Agent', agentId, 'not found in agents object!');
                    return;
                }
                
                const isActive = index === 0 ? 'active' : '';
                const agentCard = `
                    <div class="agent-card ${isActive}" data-agent="${agentId}">
                        <div class="agent-header" onclick="selectAgent(this.parentElement, '${agentId}')">
                            <div class="agent-name">
                                <div class="agent-avatar" style="background: ${agent.gradient};">${agent.avatar}</div>
                                <span>${agent.name}</span>
                            </div>
                            <div class="agent-status active"></div>
                        </div>
                        <div class="agent-tools">${agent.tools} tools enabled</div>
                        <div class="agent-actions">
                            <button class="agent-action-btn" onclick="openAgentConfig('${agentId}')" title="Configuration">
                                <span>⚙️</span>
                                <span>Config</span>
                            </button>
                            <button class="agent-action-btn" onclick="openAgentTools('${agentId}')" title="Tools">
                                <span>🛠️</span>
                                <span>Tools</span>
                            </button>
                        </div>
                    </div>
                `;
                agentsList.innerHTML += agentCard;
                console.log('DEBUG: Added agent card for', agentId);
            });
            
            console.log('DEBUG: Final agentsList innerHTML length:', agentsList.innerHTML.length);
            
            // Set first agent as current if it exists
            if (agentIds.length > 0) {
                currentAgent = agentIds[0];
                updateMainTitle();
                updateChatHeader();
                console.log('DEBUG: Set currentAgent to:', currentAgent);
            }
        }

        function initializeAgentToolsCounts() {
            // Initialize tools count for all agents
            updateSidebarToolsCount();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DEBUG: DOMContentLoaded fired');
            console.log('DEBUG: currentSwarm:', currentSwarm);
            console.log('DEBUG: swarmConfigurations:', swarmConfigurations);
            console.log('DEBUG: PythonSwarm agents:', swarmConfigurations['PythonSwarm']);
            console.log('DEBUG: agents object:', agents);
            
            updateMainTitle();
            autoResizeAllTextareas();
            
            // Initialize collaboration for PythonSwarm
            switchSwarmCollaboration('PythonSwarm');
            
            // Initialize with PythonSwarm agents
            console.log('DEBUG: Rendering agents for PythonSwarm');
            renderAgentsForSwarm('PythonSwarm');
            
            // Initialize tools count for all agents
            setTimeout(() => {
                initializeAgentToolsCounts();
                
                // Force refresh agents after a short delay
                console.log('DEBUG: Force refreshing agents');
                renderAgentsForSwarm('PythonSwarm');
            }, 200);

            // Setup custom tool category dropdown handler
            const categorySelect = document.getElementById('customToolCategory');
            if (categorySelect) {
                categorySelect.addEventListener('change', function() {
                    const customGroup = document.getElementById('customCategoryGroup');
                    if (this.value === 'custom') {
                        customGroup.style.display = 'block';
                    } else {
                        customGroup.style.display = 'none';
                    }
                });
            }

            // Listen for messages from the extension
            window.addEventListener('message', event => {
                const message = event.data;
                if (message.command === 'aiResponse') {
                    handleAIResponse(message);
                } else if (message.command === 'codeContextReceived') {
                    handleCodeContextReceived(message.data);
                } else if (message.command === 'aiChatResponse') {
                    handleAIChatResponse(message.data);
                }
            });
        });

        // Sidebar functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const collapseIcon = document.getElementById('collapseIcon');
            const logoText = document.getElementById('logoText');
            const swarmSelector = document.getElementById('swarmSelector');

            sidebarCollapsed = !sidebarCollapsed;

            if (sidebarCollapsed) {
                sidebar.classList.add('collapsed');
                mainContent.classList.add('sidebar-collapsed');
                collapseIcon.textContent = '▶';
                logoText.style.display = 'none';
                swarmSelector.style.display = 'none';
                
                // Close dropdown when collapsing
                document.querySelectorAll('.swarm-dropdown-menu.show').forEach(dropdown => {
                    dropdown.classList.remove('show');
                });
                // Reset all arrows
                document.querySelectorAll('.dropdown-arrow').forEach(arrow => {
                    arrow.style.transform = 'rotate(0deg)';
                });
            } else {
                sidebar.classList.remove('collapsed');
                mainContent.classList.remove('sidebar-collapsed');
                collapseIcon.textContent = '◀';
                logoText.style.display = 'block';
                swarmSelector.style.display = 'block';
            }
        }

        // Agent selection
        function selectAgent(element, agentId) {
            // Update active state
            document.querySelectorAll('.agent-card').forEach(card => {
                card.classList.remove('active');
            });
            element.classList.add('active');

            currentAgent = agentId;
            updateMainTitle();
            updateChatHeader();
        }

        function openAgentConfig(agentId) {
            currentAgent = agentId;
            const agent = agents[agentId];
            if (!agent) return;

            // Update modal title
            document.getElementById('configModalTitle').textContent = `${agent.name} Configuration`;

            // Generate configuration content
            const configContent = document.getElementById('agentConfigContent');
            configContent.innerHTML = generateConfigHTML(agent);

            // Open modal
            openModal('agentConfigModal');
        }

        function openAgentTools(agentId) {
            currentAgent = agentId;
            const agent = agents[agentId];
            if (!agent) return;

            // Update modal title
            document.getElementById('toolsModalTitle').textContent = `${agent.name} Tools`;

            // Generate tools content
            const toolsContent = document.getElementById('agentToolsContent');
            toolsContent.innerHTML = generateToolsHTML(agent);

            // Open modal
            openModal('agentToolsModal');
        }

        function generateConfigHTML(agent) {
            return `
                <!-- Basic Configuration Section -->
                <div class="config-section">
                    <div class="config-section-header" onclick="toggleConfigSection(this)">
                        <div class="config-section-icon basic">⚙️</div>
                        <div class="config-section-details">
                            <h3 class="config-section-title">Basic Configuration</h3>
                            <p class="config-section-subtitle">Core agent settings and basic configuration options</p>
                        </div>
                        <div class="config-section-toggle">▼</div>
                    </div>
                    <div class="config-section-content">
                        <div class="form-group">
                            <label class="form-label">Agent Name</label>
                            <input type="text" class="form-input" value="${agent.name}" onchange="updateAgentConfig('name', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">System Prompt</label>
                            <textarea class="form-textarea" onchange="updateAgentConfig('systemPrompt', this.value)">${agent.config.systemPrompt}</textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">LLM Provider</label>
                            <select class="form-input" onchange="updateAgentConfig('llmProvider', this.value)">
                                <option value="openai-gpt4" ${agent.config.llmProvider === 'openai-gpt4' ? 'selected' : ''}>OpenAI GPT-4</option>
                                <option value="openai-gpt3.5" ${agent.config.llmProvider === 'openai-gpt3.5' ? 'selected' : ''}>OpenAI GPT-3.5</option>
                                <option value="claude" ${agent.config.llmProvider === 'claude' ? 'selected' : ''}>Claude 3</option>
                                <option value="local" ${agent.config.llmProvider === 'local' ? 'selected' : ''}>Local LLM</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Advanced Settings Section -->
                <div class="config-section collapsed">
                    <div class="config-section-header" onclick="toggleConfigSection(this)">
                        <div class="config-section-icon advanced">🔧</div>
                        <div class="config-section-details">
                            <h3 class="config-section-title">Advanced Settings</h3>
                            <p class="config-section-subtitle">Performance tuning and advanced configuration options</p>
                        </div>
                        <div class="config-section-toggle">▶</div>
                    </div>
                    <div class="config-section-content">
                        <div class="form-group">
                            <label class="form-label">Response Timeout (ms)</label>
                            <input type="number" class="form-input" value="${agent.config.responseTimeout}" min="1000" max="30000" onchange="updateAgentConfig('responseTimeout', parseInt(this.value))">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Max Concurrent Tasks</label>
                            <input type="number" class="form-input" value="${agent.config.maxConcurrentTasks}" min="1" max="10" onchange="updateAgentConfig('maxConcurrentTasks', parseInt(this.value))">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Memory Management</label>
                            <select class="form-input" onchange="updateAgentConfig('memoryManagement', this.value)">
                                <option value="auto" ${agent.config.memoryManagement === 'auto' ? 'selected' : ''}>Auto</option>
                                <option value="conservative" ${agent.config.memoryManagement === 'conservative' ? 'selected' : ''}>Conservative</option>
                                <option value="aggressive" ${agent.config.memoryManagement === 'aggressive' ? 'selected' : ''}>Aggressive</option>
                            </select>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateToolsHTML(agent) {
            if (!agent.toolSections) return '<p>No tools available for this agent.</p>';

            let html = '';
            const sectionOrder = ['development', 'testing', 'management', 'deployment'];
            
            sectionOrder.forEach((sectionKey, index) => {
                const section = agent.toolSections[sectionKey];
                if (!section) return; // Skip if section doesn't exist for this agent
                
                const isCollapsed = index !== 0; // First section open by default

                html += `
                    <div class="tools-section ${isCollapsed ? 'collapsed' : ''}">
                        <div class="section-header" onclick="toggleToolsSection(this)">
                            <div class="section-icon ${sectionKey}">${section.icon}</div>
                            <div class="section-details">
                                <h3 class="section-title">${section.title}</h3>
                                <p class="section-subtitle">${section.subtitle}</p>
                            </div>
                            <div class="section-toggle">${isCollapsed ? '▶' : '▼'}</div>
                        </div>
                        <div class="tools-content">
                            ${section.tools.map(tool => `
                                <div class="tool-option">
                                    <div class="tool-info">
                                        <div class="tool-status-dot"></div>
                                        <div class="tool-details">
                                            <h4 class="tool-name">${tool.name}</h4>
                                            <p class="tool-description">${tool.description}</p>
                                        </div>
                                    </div>
                                    <div class="tool-actions">
                                        <div class="tool-toggle">
                                            <div class="toggle-switch ${tool.enabled ? 'active' : ''}" onclick="toggleAgentTool('${tool.id}', this)">
                                                <div class="toggle-slider"></div>
                                            </div>
                                            <span class="toggle-label">${tool.enabled ? 'Enabled' : 'Disabled'}</span>
                                        </div>
                                        ${tool.id.startsWith('custom_') ? `
                                            <button class="delete-tool-btn" onclick="deleteCustomTool('${tool.id}')" title="Delete Tool">
                                                <span>🗑️</span>
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            return html;
        }

        function updateMainTitle() {
            // Keep the main title consistent as multi-agent collaboration hub
            const mainTitle = document.getElementById('mainTitle');
            mainTitle.textContent = 'Multi-Agent Collaboration Hub';
        }

        function updateChatHeader() {
            // Update the chat status to show active agents count
            const activeAgentCount = Object.keys(agents).length;
            const chatStatusText = document.getElementById('chatStatusText');
            
            if (chatStatusText) {
                chatStatusText.textContent = `${activeAgentCount} agents online • Ready to collaborate`;
            }
        }

        // Chat functions
        function handleChatKeydown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        function autoResizeAllTextareas() {
            document.querySelectorAll('textarea').forEach(textarea => {
                autoResizeTextarea(textarea);
            });
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            console.log('DEBUG: sendMessage called with:', message);
            console.log('DEBUG: currentSwarm:', currentSwarm);

            // Add user message if there is one, otherwise use default demo message
            const demoMessage = message || 'Create a Python todo app';
            
            if (message) {
                addMessage('user', 'You', message);
                input.value = '';
                autoResizeTextarea(input);
            } else {
                // Show default message for demo
                addMessage('user', 'You', demoMessage);
            }

            // ALWAYS TRIGGER DEMO - works with or without input
            console.log('DEBUG: TRIGGERING PYTHON DEMO');
            
            // Start the demo sequence
            triggerPythonDemo(demoMessage);
            return;
        }

        function triggerPythonDemo(originalMessage) {
            console.log('DEBUG: triggerPythonDemo called with:', originalMessage);
            
            // Clear any existing typing indicators
            hideTypingIndicator();
            
            // Start the demo sequence
            console.log('DEBUG: Starting demo sequence');
            
            // Get current global collaboration rules
            const collaborationRules = getGlobalCollaborationRules();
            console.log('DEBUG: Using collaboration rules:', collaborationRules);
            
            // Orchestrator response
            setTimeout(() => {
                const orchestratorResponse = `🎯 <strong>Python Todo App Project Analysis:</strong><br>Coordinating development using our team collaboration framework.<br><br>` +
                    `<div style="background: var(--input-bg); padding: 12px; border-radius: 8px; margin-top: 8px;">` +
                    `<strong>🤝 Collaboration Protocol Active:</strong><br>` +
                    `� Project delegated to specialized agents<br>` +
                    `🔄 Progress monitoring initiated<br>` +
                    `⚡ Real-time coordination enabled<br><br>` +
                    `<strong>�🐍 Python Development Plan:</strong><br>` +
                    `• Backend: Flask web framework ✓<br>` +
                    `• Database: SQLite with persistence ✓<br>` +
                    `• Frontend: HTML/CSS/JavaScript UI ✓<br>` +
                    `• Testing: Comprehensive QA testing ✓<br><br>` +
                    `Following team collaboration rules for seamless development...</div>`;
                
                addMessage('agent', 'Orchestrator Agent', orchestratorResponse, '🎯', 'linear-gradient(135deg, #667eea, #764ba2)');
                addLogEntry('orchestrator', 'Python Todo App coordination using global collaboration rules', '🔄 Coordinating', 'coordinating');
                
                // Trigger file creation in extension - IMPORTANT: This creates the files
                console.log('DEBUG: Sending file creation message to extension');
                vscode.postMessage({
                    command: 'pythonTodoDemo',
                    data: { 
                        message: originalMessage || 'Create a Python todo app',
                        collaborationRules: collaborationRules
                    }
                });
            }, 1000);
            
            // Python Developer response
            setTimeout(() => {
                const pythonDevResponse = `🐍 <strong>Flask Backend Development:</strong><br>Following team coordination protocol - implementing backend logic as delegated...<br><br>` +
                    `<div style="background: #1a1a1a; color: #00ff00; padding: 12px; border-radius: 8px; font-family: monospace; font-size: 11px; margin-top: 8px;">` +
                    `<span style="color: #888;">$</span> pip install Flask<br>` +
                    `<span style="color: #4fc3f7;">✓</span> Flask installed successfully<br>` +
                    `<span style="color: #888;">$</span> Creating app.py with routes...<br>` +
                    `<span style="color: #4fc3f7;">✓</span> POST /api/todos - Add new todo<br>` +
                    `<span style="color: #4fc3f7;">✓</span> GET /api/todos - List all todos<br>` +
                    `<span style="color: #4fc3f7;">✓</span> PUT /api/todos/:id - Update todo<br>` +
                    `<span style="color: #4fc3f7;">✓</span> DELETE /api/todos/:id - Delete todo<br>` +
                    `<span style="color: #888;">$</span> SQLite database initialized</div><br>` +
                    `<strong>Status:</strong> Backend ready for frontend integration. Reporting to Orchestrator...`;
                
                addMessage('agent', 'Python Developer', pythonDevResponse, '🐍', 'linear-gradient(135deg, #3b82f6, #1d4ed8)');
                addLogEntry('python_dev', 'Flask API: Backend complete, ready for frontend integration', '✓ Backend Ready', 'success');
            }, 3000);
            
            // Frontend Developer response  
            setTimeout(() => {
                const frontendResponse = `🎨 <strong>Todo App UI Development:</strong><br>Coordinating with Python Developer - building responsive interface for backend integration...<br><br>` +
                    `<div style="background: var(--input-bg); padding: 12px; border-radius: 8px; margin-top: 8px;">` +
                    `<strong>🎨 Frontend Components Created:</strong><br>` +
                    `✅ Todo input form with validation<br>` +
                    `✅ Todo list with edit/delete actions<br>` +
                    `✅ Status toggle (completed/pending)<br>` +
                    `✅ Filter controls (all/active/completed)<br>` +
                    `✅ Responsive CSS with mobile support<br>` +
                    `✅ JavaScript for API integration<br><br>` +
                    `<strong>Integration:</strong> Frontend seamlessly connected to Python backend APIs</div>`;
                
                addMessage('agent', 'Frontend Developer', frontendResponse, '🎨', 'linear-gradient(135deg, #61dafb, #21759b)');
                addLogEntry('frontend_dev', 'UI complete: Responsive design integrated with Python backend', '🎨 Frontend Ready', 'success');
            }, 6000);
            
            // QA Tester response
            setTimeout(() => {
                const qaResponse = `🧪 <strong>Quality Assurance Complete:</strong><br>Following team protocols - validating all implementations and reporting findings...<br><br>` +
                    `<div style="background: var(--input-bg); padding: 12px; border-radius: 8px; margin-top: 8px;">` +
                    `<strong>🧪 Testing Results:</strong><br>` +
                    `✅ Unit Tests (6/6 passed, 100% coverage)<br>` +
                    `✅ Integration Tests (API endpoints working)<br>` +
                    `✅ Frontend Tests (UI interactions verified)<br>` +
                    `✅ Manual Testing (User workflow validated)<br>` +
                    `✅ Cross-browser Testing (Chrome, Firefox, Safari)<br><br>` +
                    `<strong>Quality Report:</strong> All standards met. Reporting to development team and Orchestrator.</div>`;
                
                addMessage('agent', 'QA Tester', qaResponse, '🧪', 'linear-gradient(135deg, #10b981, #059669)');
                addLogEntry('qa_tester', 'Testing complete: Quality assured, reporting to team', '✅ QA Approved', 'success');
            }, 9000);
            
            // Final summary
            setTimeout(() => {
                const finalResponse = `🎉 <strong>Python Todo App Complete!</strong><br>Team collaboration successful! Flask-based todo application ready following our coordination protocol.<br><br>` +
                    `<div style="background: var(--input-bg); padding: 12px; border-radius: 8px; margin-top: 8px;">` +
                    `<strong>📁 Project Structure:</strong><br>` +
                    `├── app.py (Flask backend)<br>` +
                    `├── templates/index.html (UI)<br>` +
                    `├── static/style.css (Styling)<br>` +
                    `├── static/script.js (JavaScript)<br>` +
                    `└── requirements.txt (Dependencies)<br><br>` +
                    `<strong>🔧 Tech Stack:</strong> Python Flask, SQLite, HTML/CSS/JS<br>` +
                    `<strong>🤝 Collaboration:</strong> All agents coordinated successfully<br>` +
                    `<strong>🚀 Ready to run:</strong> cd python-todo-demo && python app.py</div>`;
                
                addMessage('agent', 'Orchestrator Agent', finalResponse, '🎯', 'linear-gradient(135deg, #667eea, #764ba2)');
                addLogEntry('orchestrator', 'Project complete: Successful team collaboration', '🎉 Deployed', 'success');
            }, 12000);
        }

        function handleProjectRequest(message) {
            // Check if we're using PythonSwarm and handle Python app creation
            const lowerMessage = message.toLowerCase();
            console.log('DEBUG: handleProjectRequest called');
            console.log('DEBUG: lowerMessage:', lowerMessage);
            console.log('DEBUG: currentSwarm:', currentSwarm);
            
            const pythonDetected = lowerMessage.includes('python');
            const flaskDetected = lowerMessage.includes('flask');
            const sqliteDetected = lowerMessage.includes('sqlite');
            const todoDetected = lowerMessage.includes('todo');
            const taskDetected = lowerMessage.includes('task');
            
            console.log('DEBUG: Detection results:', {
                pythonDetected,
                flaskDetected,
                sqliteDetected,
                todoDetected,
                taskDetected
            });
            
            if (currentSwarm === 'PythonSwarm' && 
                (lowerMessage.includes('python') && (lowerMessage.includes('flask') || lowerMessage.includes('sqlite'))) ||
                (lowerMessage.includes('todo') || lowerMessage.includes('task'))) {
                console.log('DEBUG: Python demo triggered!');
                handlePythonTodoRequest(message);
                return;
            }
            
            console.log('DEBUG: Python demo NOT triggered, using default handling');
            
            // Default project request handling for other swarms
            // First, Orchestrator responds
            setTimeout(() => {
                hideTypingIndicator();
                const orchestratorResponse = `🎯 <strong>Project Analysis:</strong><br>I'll coordinate the development of your project: "${message}"<br><br>` +
                    `<div style="background: var(--input-bg); padding: 12px; border-radius: 8px; margin-top: 8px;">` +
                    `<strong>Coordination Plan:</strong><br>` +
                    `• Planning & Architecture ⏳<br>` +
                    `• Development Setup ⏳<br>` +
                    `• Testing Strategy ⏳<br>` +
                    `• Deployment Pipeline ⏳<br><br>` +
                    `Delegating tasks to specialized agents...</div>`;
                
                addMessage('agent', agents.orchestrator.name, orchestratorResponse, 
                          agents.orchestrator.avatar, agents.orchestrator.gradient);
                
                addLogEntry('orchestrator', `Project coordination: "${message.substring(0, 30)}..."`, '🔄 Coordinating', 'coordinating');
            }, 1500);

            // Then show CI/CD Agent starting work
            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    hideTypingIndicator();
                    const cicdResponse = `🚀 <strong>Development Environment Setup:</strong><br>Setting up CI/CD pipeline for your project...<br><br>` +
                        `<div style="background: #1a1a1a; color: #00ff00; padding: 12px; border-radius: 8px; font-family: monospace; font-size: 11px; margin-top: 8px;">` +
                        `<span style="color: #888;">$</span> mkdir notes-app && cd notes-app<br>` +
                        `<span style="color: #888;">$</span> npm init -y<br>` +
                        `<span style="color: #4fc3f7;">✓</span> Package.json created<br>` +
                        `<span style="color: #888;">$</span> git init<br>` +
                        `<span style="color: #4fc3f7;">✓</span> Repository initialized<br>` +
                        `<span style="color: #888;">$</span> Creating GitHub Actions workflow...<br>` +
                        `<span style="color: #4fc3f7;">✓</span> CI/CD pipeline configured</div>`;
                    
                    addMessage('agent', agents.cicd.name, cicdResponse, 
                              agents.cicd.avatar, agents.cicd.gradient);
                    
                    addLogEntry('cicd', 'Repository setup: Git initialized, CI/CD pipeline configured', '✓ Completed', 'success');
                }, 2000);
            }, 3000);

            // Tests Agent creates testing strategy
            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    hideTypingIndicator();
                    const testsResponse = `🧪 <strong>Testing Strategy Development:</strong><br>Creating comprehensive test suite for your notes app...<br><br>` +
                        `<div style="background: var(--input-bg); padding: 12px; border-radius: 8px; margin-top: 8px;">` +
                        `<strong>Test Plan Created:</strong><br>` +
                        `✅ Unit Tests: Core functionality<br>` +
                        `✅ Integration Tests: Data persistence<br>` +
                        `✅ E2E Tests: User workflows<br>` +
                        `✅ Performance Tests: Load handling<br><br>` +
                        `📊 Target Coverage: 95%<br>` +
                        `🔧 Test Framework: Jest + Testing Library</div>`;
                    
                    addMessage('agent', agents.tests.name, testsResponse, 
                              agents.tests.avatar, agents.tests.gradient);
                    
                    addLogEntry('tests', 'Test strategy: Framework setup, 95% coverage target set', '✓ Planned', 'success');
                }, 2500);
            }, 6000);

            // Writer Agent creates documentation
            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    hideTypingIndicator();
                    const writerResponse = `✍️ <strong>Documentation Creation:</strong><br>Preparing comprehensive documentation for your notes app...<br><br>` +
                        `<div style="background: var(--input-bg); padding: 12px; border-radius: 8px; margin-top: 8px;">` +
                        `<strong>Documentation Suite:</strong><br>` +
                        `📋 README.md with setup instructions<br>` +
                        `📚 API documentation and examples<br>` +
                        `👥 User guide and tutorials<br>` +
                        `🔧 Developer contributing guidelines<br><br>` +
                        `📝 Style: Clear, professional, and user-friendly<br>` +
                        `🎯 Audience: Developers and end users</div>`;
                    
                    addMessage('agent', agents.writer.name, writerResponse, 
                              agents.writer.avatar, agents.writer.gradient);
                    
                    addLogEntry('writer', 'Documentation: README, API docs, user guides created', '✓ Documented', 'success');
                }, 2200);
            }, 8500);

            // Final orchestrator summary
            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    hideTypingIndicator();
                    const finalResponse = `✅ <strong>Project Setup Complete!</strong><br>Your notes app development environment is ready.<br><br>` +
                        `<div style="background: var(--input-bg); padding: 12px; border-radius: 8px; margin-top: 8px;">` +
                        `<strong>Next Steps:</strong><br>` +
                        `1. Start coding the core features<br>` +
                        `2. Run tests continuously<br>` +
                        `3. Deploy to staging when ready<br><br>` +
                        `<strong>Repository:</strong> notes-app/<br>` +
                        `<strong>Stack:</strong> Node.js, Jest, GitHub Actions<br>` +
                        `<strong>Status:</strong> Ready for development 🚀</div>`;
                    
                    addMessage('agent', agents.orchestrator.name, finalResponse, 
                              agents.orchestrator.avatar, agents.orchestrator.gradient);
                    
                    addLogEntry('orchestrator', 'Project setup completed: Ready for development', '✅ Ready', 'success');
                }, 1800);
            }, 11000);
        }

        function handlePythonTodoRequest(message) {
            console.log('DEBUG: handlePythonTodoRequest called with:', message);
            
            // First, Orchestrator responds with Python-specific coordination
            setTimeout(() => {
                hideTypingIndicator();
                console.log('DEBUG: Adding orchestrator response');
                const orchestratorResponse = `🎯 <strong>Python Todo App Project Analysis:</strong><br>Coordinating development of your todo application using Python stack.<br><br>` +
                    `<div style="background: var(--input-bg); padding: 12px; border-radius: 8px; margin-top: 8px;">` +
                    `<strong>🐍 Python Development Plan:</strong><br>` +
                    `• Backend: Flask web framework ⏳<br>` +
                    `• Database: SQLite with persistence ⏳<br>` +
                    `• Frontend: HTML/CSS/JavaScript UI ⏳<br>` +
                    `• Testing: Comprehensive QA testing ⏳<br><br>` +
                    `Delegating to Python development specialists...</div>`;
                
                addMessage('agent', agents.orchestrator.name, orchestratorResponse, 
                          agents.orchestrator.avatar, agents.orchestrator.gradient);
                
                addLogEntry('orchestrator', `Python Todo App coordination: Flask + SQLite stack`, '🔄 Coordinating', 'coordinating');
            }, 1500);

            // Python Developer starts backend development
            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    hideTypingIndicator();
                    const pythonDevResponse = `🐍 <strong>Flask Backend Development:</strong><br>Creating the todo app backend with Flask and SQLite...<br><br>` +
                        `<div style="background: #1a1a1a; color: #00ff00; padding: 12px; border-radius: 8px; font-family: monospace; font-size: 11px; margin-top: 8px;">` +
                        `<span style="color: #888;">$</span> pip install Flask SQLAlchemy<br>` +
                        `<span style="color: #4fc3f7;">✓</span> Flask installed successfully<br>` +
                        `<span style="color: #888;">$</span> Creating app.py with routes...<br>` +
                        `<span style="color: #4fc3f7;">✓</span> POST /api/todos - Add new todo<br>` +
                        `<span style="color: #4fc3f7;">✓</span> GET /api/todos - List all todos<br>` +
                        `<span style="color: #4fc3f7;">✓</span> PUT /api/todos/:id - Update todo<br>` +
                        `<span style="color: #4fc3f7;">✓</span> DELETE /api/todos/:id - Delete todo<br>` +
                        `<span style="color: #888;">$</span> SQLite database initialized</div><br>` +
                        `<strong>Features implemented:</strong> CRUD operations, data persistence, RESTful API`;
                    
                    addMessage('agent', agents.python_dev.name, pythonDevResponse, 
                              agents.python_dev.avatar, agents.python_dev.gradient);
                    
                    addLogEntry('python_dev', 'Flask API: CRUD routes created, SQLite database setup', '✓ Backend Ready', 'success');
                }, 2500);
            }, 3000);

            // Frontend Developer creates the UI
            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    hideTypingIndicator();
                    const frontendResponse = `🎨 <strong>Todo App UI Development:</strong><br>Building responsive frontend interface for the todo application...<br><br>` +
                        `<div style="background: var(--input-bg); padding: 12px; border-radius: 8px; margin-top: 8px;">` +
                        `<strong>🎨 Frontend Components Created:</strong><br>` +
                        `✅ Todo input form with validation<br>` +
                        `✅ Todo list with edit/delete actions<br>` +
                        `✅ Status toggle (completed/pending)<br>` +
                        `✅ Filter controls (all/active/completed)<br>` +
                        `✅ Responsive CSS with mobile support<br>` +
                        `✅ JavaScript for API integration<br><br>` +
                        `<strong>Tech Stack:</strong> HTML5, CSS3, Vanilla JavaScript<br>` +
                        `<strong>Design:</strong> Clean, modern, user-friendly interface</div>`;
                    
                    addMessage('agent', agents.frontend_dev.name, frontendResponse, 
                              agents.frontend_dev.avatar, agents.frontend_dev.gradient);
                    
                    addLogEntry('frontend_dev', 'UI Components: Forms, lists, filters with responsive design', '✓ Frontend Ready', 'success');
                }, 2200);
            }, 6000);

            // QA Tester validates the application
            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    hideTypingIndicator();
                    const qaResponse = `🧪 <strong>Todo App Quality Assurance:</strong><br>Comprehensive testing of Python todo application...<br><br>` +
                        `<div style="background: var(--input-bg); padding: 12px; border-radius: 8px; margin-top: 8px;">` +
                        `<strong>🔍 Testing Results:</strong><br>` +
                        `✅ Unit Tests: API endpoints (100% coverage)<br>` +
                        `✅ Integration Tests: Database operations<br>` +
                        `✅ Frontend Tests: User interactions<br>` +
                        `✅ API Tests: CRUD functionality<br>` +
                        `✅ Manual Testing: End-to-end workflows<br>` +
                        `✅ Cross-browser: Chrome, Firefox, Safari<br><br>` +
                        `<strong>Test Framework:</strong> pytest for backend, manual testing for UI<br>` +
                        `<strong>Status:</strong> All tests passing ✅</div>`;
                    
                    addMessage('agent', agents.qa_tester.name, qaResponse, 
                              agents.qa_tester.avatar, agents.qa_tester.gradient);
                    
                    addLogEntry('qa_tester', 'Testing complete: 100% test coverage, all validations passed', '✅ QA Approved', 'success');
                }, 2000);
            }, 8500);

            // Final orchestrator summary for Python todo app
            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    hideTypingIndicator();
                    const finalResponse = `🎉 <strong>Python Todo App Complete!</strong><br>Your Flask-based todo application is ready for deployment.<br><br>` +
                        `<div style="background: var(--input-bg); padding: 12px; border-radius: 8px; margin-top: 8px;">` +
                        `<strong>🚀 Deployment Ready:</strong><br>` +
                        `📁 <strong>Project Structure:</strong><br>` +
                        `&nbsp;&nbsp;├── app.py (Flask backend)<br>` +
                        `&nbsp;&nbsp;├── templates/index.html<br>` +
                        `&nbsp;&nbsp;├── static/style.css<br>` +
                        `&nbsp;&nbsp;├── static/script.js<br>` +
                        `&nbsp;&nbsp;├── todos.db (SQLite database)<br>` +
                        `&nbsp;&nbsp;└── tests/ (pytest test suite)<br><br>` +
                        `<strong>🔧 Tech Stack:</strong> Python Flask, SQLite, HTML/CSS/JS<br>` +
                        `<strong>✅ Features:</strong> Add, edit, delete, filter todos<br>` +
                        `<strong>🧪 Quality:</strong> 100% test coverage<br>` +
                        `<strong>🎯 Status:</strong> Production ready! 🚀</div>`;
                    
                    addMessage('agent', agents.orchestrator.name, finalResponse, 
                              agents.orchestrator.avatar, agents.orchestrator.gradient);
                    
                    addLogEntry('orchestrator', 'Python Todo App: Complete Flask application with full testing', '🎉 Deployed', 'success');
                }, 1800);
            }, 11000);
        }

        function handleGeneralRequest(message) {
            setTimeout(() => {
                hideTypingIndicator();
                const agent = agents[currentAgent];
                
                // Enhanced responses without "mock" or "fake" language
                const responseTemplates = {
                    orchestrator: [
                        `🎯 <strong>Task Analysis:</strong><br>I've analyzed your request "${message}" and I'm coordinating the response.<br><br>` +
                        `<div style="background: var(--input-bg); padding: 8px; border-radius: 6px; margin-top: 8px;">` +
                        `<em>Step 1:</em> Requirements analysis ✓<br>` +
                        `<em>Step 2:</em> Resource allocation ⏳<br>` +
                        `<em>Step 3:</em> Task delegation 📋</div>`,
                        
                        `⚙️ <strong>Coordination Active:</strong><br>Processing: "${message}"<br><br>` +
                        `Working with specialized agents to provide comprehensive solution...`,
                        
                        `🤝 <strong>Multi-Agent Response:</strong><br>Your request requires collaboration between multiple agents. ` +
                        `I'm orchestrating the workflow and will provide updates as tasks complete.`
                    ],
                    cicd: [
                        `🚀 <strong>Pipeline Analysis:</strong><br>Analyzing deployment requirements for your request...<br><br>` +
                        `<div style="background: #1a1a1a; color: #00ff00; padding: 10px; border-radius: 6px; font-family: monospace; font-size: 11px; margin-top: 8px;">` +
                        `<span style="color: #4fc3f7;">✓</span> Environment check: PASSED<br>` +
                        `<span style="color: #4fc3f7;">✓</span> Dependencies: RESOLVED<br>` +
                        `<span style="color: #ffb74d;">⏳</span> Processing request...</div>`,
                        
                        `🔧 <strong>Infrastructure Ready:</strong><br>System resources allocated for "${message}"<br><br>` +
                        `📊 <strong>Status:</strong><br>• Build capacity: Available<br>• Deploy slots: 3 free<br>• Test runners: Online`,
                        
                        `📦 <strong>Pipeline Status:</strong><br>Infrastructure prepared for task execution.<br><br>` +
                        `Ready to proceed with implementation and deployment phases.`
                    ],
                    tests: [
                        `🧪 <strong>Quality Assurance:</strong><br>Preparing testing strategy for your request...<br><br>` +
                        `<div style="background: var(--input-bg); padding: 8px; border-radius: 6px; margin-top: 8px;">` +
                        `✅ Test scenarios identified<br>✅ Quality gates configured<br>✅ Coverage targets set<br>📊 Ready for validation</div>`,
                        
                        `🔍 <strong>Testing Framework:</strong><br>Quality analysis prepared for "${message}"<br><br>` +
                        `📈 <strong>Approach:</strong><br>• Functional testing strategy<br>• Performance benchmarks<br>• Security validation<br>• User acceptance criteria`,
                        
                        `⚡ <strong>Quality Pipeline:</strong><br>Testing infrastructure initialized and ready for validation cycles.`
                    ],
                    writer: [
                        `✍️ <strong>Content Creation:</strong><br>Analyzing your content request: "${message}"<br><br>` +
                        `<div style="background: var(--input-bg); padding: 8px; border-radius: 6px; margin-top: 8px;">` +
                        `📝 Content type identified<br>🎯 Target audience analyzed<br>📚 Style guidelines applied<br>✨ Draft ready for review</div>`,
                        
                        `📝 <strong>Professional Writing:</strong><br>Content developed with clear, engaging structure for "${message}"<br><br>` +
                        `📈 <strong>Approach:</strong><br>• Clear, informative tone<br>• Technical accuracy<br>• Professional formatting<br>• Audience-appropriate language`,
                        
                        `📚 <strong>Documentation Ready:</strong><br>Content crafted with professional standards and technical precision.`
                    ]
                };

                // Get agent-specific responses or fallback to general ones
                const agentResponses = responseTemplates[currentAgent] || [
                    `🤖 <strong>Processing Request:</strong><br>Working on "${message}" using specialized capabilities.`,
                    `⚙️ <strong>Analysis Complete:</strong><br>Request processed and solution being prepared.`,
                    `🎯 <strong>Task Execution:</strong><br>Successfully handling your request with systematic approach.`
                ];

                const randomResponse = agentResponses[Math.floor(Math.random() * agentResponses.length)];
                addMessage('agent', agent.name, randomResponse, agent.avatar, agent.gradient);
                
                // Add appropriate log entry
                const logContent = `Processed request: "${message.substring(0, 40)}${message.length > 40 ? '...' : ''}"`;
                addLogEntry(currentAgent, logContent, '✓ Completed', 'success');
            }, 1500);
        }

        function addMessage(type, sender, content, avatar = null, gradient = null) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ' + type;

            const currentTime = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            messageDiv.innerHTML = 
                '<div class="message-bubble">' +
                (type === 'agent' ? 
                    '<div class="message-header">' +
                        '<div class="message-avatar" style="background: ' + gradient + '">' + avatar + '</div>' +
                        '<span>' + sender + '</span>' +
                        '<span>•</span>' +
                        '<span>' + currentTime + '</span>' +
                    '</div>' : '') +
                    '<div class="message-content">' + content + '</div>' +
                '</div>';

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            const messagesContainer = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'typing-indicator';
            typingDiv.innerHTML = 
                '<span style="font-size: 12px; color: var(--vscode-descriptionForeground);">Agent is typing</span>' +
                '<div class="typing-dots">' +
                    '<div class="typing-dot"></div>' +
                    '<div class="typing-dot"></div>' +
                    '<div class="typing-dot"></div>' +
                '</div>';

            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            isTyping = true;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
            isTyping = false;
        }

        // Configuration functions
        function toggleConfigSection(header) {
            const section = header.parentElement;
            const content = section.querySelector('.config-section-content');
            const arrow = header.querySelector('.config-section-toggle');

            section.classList.toggle('collapsed');
            
            if (section.classList.contains('collapsed')) {
                arrow.textContent = '▶';
            } else {
                arrow.textContent = '▼';
            }
        }

        function updateAgentName(newName) {
            if (agents[currentAgent]) {
                agents[currentAgent].name = newName;
                updateMainTitle();
                updateChatHeader();
                
                // Update sidebar
                const activeCard = document.querySelector('.agent-card.active');
                if (activeCard) {
                    const nameSpan = activeCard.querySelector('.agent-name span');
                    if (nameSpan) {
                        nameSpan.textContent = newName;
                    }
                }

                // Send update to extension
                vscode.postMessage({
                    command: 'updateAgent',
                    data: { id: currentAgent, name: newName }
                });
            }
        }

        function updateAgentConfig(field, value) {
            if (agents[currentAgent] && agents[currentAgent].config) {
                if (field === 'name') {
                    updateAgentName(value);
                } else {
                    // Store old value for comparison
                    const oldValue = agents[currentAgent].config[field];
                    agents[currentAgent].config[field] = value;

                    // Special handling for system prompt changes to demonstrate the effect
                    if (field === 'systemPrompt' && currentAgent === 'writer' && oldValue !== value) {
                        demonstratePromptChange(oldValue, value);
                    }
                    
                    // Send config update to extension
                    vscode.postMessage({
                        command: 'updateAgentConfig',
                        data: { 
                            id: currentAgent, 
                            field: field, 
                            value: value,
                            config: agents[currentAgent].config
                        }
                    });
                }
            }
        }

        function demonstratePromptChange(oldPrompt, newPrompt) {
            setTimeout(() => {
                // First, show the "before" example with old prompt
                const beforeMessage = `📝 <strong>System Prompt Analysis:</strong><br>Let me demonstrate how prompt changes affect my responses.<br><br>` +
                    `<div style="background: var(--input-bg); padding: 12px; border-radius: 8px; margin-bottom: 12px; border-left: 4px solid var(--accent-red);">` +
                    `<strong>Previous Prompt:</strong><br>"${oldPrompt.substring(0, 100)}${oldPrompt.length > 100 ? '...' : ''}"<br><br>` +
                    `<strong>Sample Response (Previous Style):</strong><br>` +
                    `"This document provides comprehensive technical specifications for the proposed solution. The implementation follows industry best practices and ensures optimal performance metrics."</div>` +
                    
                    `<div style="background: var(--input-bg); padding: 12px; border-radius: 8px; border-left: 4px solid var(--accent-green);">` +
                    `<strong>Updated Prompt:</strong><br>"${newPrompt.substring(0, 100)}${newPrompt.length > 100 ? '...' : ''}"<br><br>` +
                    `<strong>Sample Response (New Style):</strong><br>` +
                    getResponseForPrompt(newPrompt) + `</div>`;

                addMessage('agent', agents.writer.name, beforeMessage, agents.writer.avatar, agents.writer.gradient);
                addLogEntry('writer', 'System prompt updated: Demonstrating response changes', '📝 Modified', 'modified');
            }, 500);
        }

        function getResponseForPrompt(prompt) {
            if (prompt.toLowerCase().includes('casual') || prompt.toLowerCase().includes('friendly')) {
                return `"Hey! So here's the deal with this solution - it's pretty awesome and follows all the best practices. You're gonna love how smooth everything runs!"`;
            } else if (prompt.toLowerCase().includes('technical') || prompt.toLowerCase().includes('detailed')) {
                return `"Technical Analysis: Implementation utilizes advanced algorithms with O(n log n) complexity. System architecture incorporates microservices pattern with containerized deployment strategy."`;
            } else if (prompt.toLowerCase().includes('creative') || prompt.toLowerCase().includes('engaging')) {
                return `"Picture this: a solution that dances through your requirements like a master chef creating the perfect recipe. Every component harmonizes beautifully with the next!"`;
            } else if (prompt.toLowerCase().includes('concise') || prompt.toLowerCase().includes('brief')) {
                return `"Solution: Fast, reliable, scalable. Done."`;
            } else {
                return `"This solution effectively addresses your requirements with a balanced approach to functionality and performance."`;
            }
        }

        // Tool functions
        function toggleAgentTool(toolId, toggleElement) {
            const label = toggleElement.parentElement.querySelector('.toggle-label');
            const isEnabled = toggleElement.classList.contains('active');
            
            if (isEnabled) {
                // Disable tool
                toggleElement.classList.remove('active');
                label.textContent = 'Disabled';
            } else {
                // Enable tool
                toggleElement.classList.add('active');
                label.textContent = 'Enabled';
            }

            // Update the agent's tool data
            if (agents[currentAgent] && agents[currentAgent].toolSections) {
                Object.keys(agents[currentAgent].toolSections).forEach(sectionKey => {
                    const section = agents[currentAgent].toolSections[sectionKey];
                    const tool = section.tools.find(t => t.id === toolId);
                    if (tool) {
                        tool.enabled = !isEnabled;
                    }
                });

                // Update enabled tools count
                const enabledCount = Object.values(agents[currentAgent].toolSections)
                    .flatMap(section => section.tools)
                    .filter(tool => tool.enabled).length;
                
                agents[currentAgent].tools = enabledCount;
                
                // Update the sidebar display
                updateSidebarToolsCount();
            }

            // Send to extension
            vscode.postMessage({
                command: 'toggleTool',
                data: { 
                    toolId: toolId, 
                    enabled: !isEnabled,
                    agent: currentAgent 
                }
            });
        }

        function updateSidebarToolsCount() {
            const agentCards = document.querySelectorAll('.agent-card');
            agentCards.forEach(card => {
                const agentId = card.getAttribute('data-agent');
                const toolsElement = card.querySelector('.agent-tools');
                
                if (agentId && toolsElement && agents[agentId]) {
                    const count = agents[agentId].tools;
                    toolsElement.textContent = `${count} tools enabled`;
                }
            });
        }

        function toggleToolsSection(header) {
            const section = header.parentElement;
            const content = section.querySelector('.tools-content');
            const arrow = header.querySelector('.section-toggle');

            section.classList.toggle('collapsed');
            
            if (section.classList.contains('collapsed')) {
                arrow.textContent = '▶';
            } else {
                arrow.textContent = '▼';
            }
        }

        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function createNewAgent() {
            const name = document.getElementById('newAgentName').value.trim();
            const role = document.getElementById('newAgentRole').value;
            const prompt = document.getElementById('newAgentPrompt').value.trim();

            if (!name) {
                vscode.postMessage({
                    command: 'error',
                    text: 'Please enter an agent name'
                });
                return;
            }

            // Create new agent
            const agentId = 'agent_' + Date.now();
            const avatar = name.charAt(0).toUpperCase();
            const gradients = [
                'var(--gradient-primary)',
                'var(--gradient-secondary)',
                'linear-gradient(135deg, var(--accent-purple), var(--accent-red))',
                'linear-gradient(135deg, var(--accent-orange), var(--accent-red))'
            ];
            const randomGradient = gradients[Math.floor(Math.random() * gradients.length)];

            // Create default tools structure for new agent
            const defaultToolSections = {
                'development': {
                    title: 'Development',
                    subtitle: 'Code analysis, dependency management, and development utilities',
                    icon: '💻',
                    tools: [
                        { id: 'basic-analysis', name: 'Basic Analysis', description: 'Performs basic analysis and reporting', enabled: true },
                        { id: 'code-review', name: 'Code Review', description: 'Assists with code review processes', enabled: false }
                    ]
                },
                'testing': {
                    title: 'Testing',
                    subtitle: 'Quality assurance and validation tools',
                    icon: '🧪',
                    tools: [
                        { id: 'basic-testing', name: 'Basic Testing', description: 'Performs basic testing and validation', enabled: false }
                    ]
                },
                'management': {
                    title: 'Management',
                    subtitle: 'Task management and coordination tools',
                    icon: '⚙️',
                    tools: [
                        { id: 'task-management', name: 'Task Management', description: 'Manages assigned tasks and responsibilities', enabled: false }
                    ]
                },
                'deployment': {
                    title: 'Deployment',
                    subtitle: 'Deployment support and coordination',
                    icon: '🚀',
                    tools: [
                        { id: 'deployment-support', name: 'Deployment Support', description: 'Provides support during deployment processes', enabled: false }
                    ]
                }
            };

            agents[agentId] = {
                name: name,
                avatar: avatar,
                gradient: randomGradient,
                tools: 1,
                enabledTools: ['basic-analysis'],
                toolSections: defaultToolSections,
                config: {
                    systemPrompt: prompt || `You are a ${role} agent specialized in ${name.toLowerCase()} tasks.`,
                    llmProvider: 'openai-gpt4',
                    responseTimeout: 5000,
                    maxConcurrentTasks: 3,
                    memoryManagement: 'auto'
                }
            };

            // Add to sidebar
            const agentsList = document.getElementById('agentsList');
            const newAgentCard = document.createElement('div');
            newAgentCard.className = 'agent-card';
            newAgentCard.setAttribute('data-agent', agentId);
            newAgentCard.innerHTML = 
                `<div class="agent-header" onclick="selectAgent(this.parentElement, '${agentId}')">
                    <div class="agent-name">
                        <div class="agent-avatar" style="background: ${randomGradient};">${avatar}</div>
                        <span>${name}</span>
                    </div>
                    <div class="agent-status active"></div>
                </div>
                <div class="agent-tools">1 tools enabled</div>
                <div class="agent-actions">
                    <button class="agent-action-btn" onclick="openAgentConfig('${agentId}')" title="Configuration">
                        <span>⚙️</span>
                        <span>Config</span>
                    </button>
                    <button class="agent-action-btn" onclick="openAgentTools('${agentId}')" title="Tools">
                        <span>🛠️</span>
                        <span>Tools</span>
                    </button>
                </div>`;

            agentsList.appendChild(newAgentCard);

            // Update chat header to reflect new agent count
            updateChatHeader();

            // Clear form and close modal
            document.getElementById('newAgentName').value = '';
            document.getElementById('newAgentRole').value = 'general';
            document.getElementById('newAgentPrompt').value = '';
            closeModal('newAgentModal');

            // Send to extension
            vscode.postMessage({
                command: 'createAgent',
                data: { id: agentId, name: name, role: role, prompt: prompt }
            });

            // Show success message
            addMessage('agent', 'System', 'New agent "' + name + '" has been created successfully!', '🎉', 'var(--gradient-secondary)');
        }

        function createCustomSwarm() {
            const name = document.getElementById('customSwarmName').value.trim();
            const description = document.getElementById('customSwarmDescription').value.trim();
            const template = document.getElementById('customSwarmTemplate').value;

            if (!name) {
                vscode.postMessage({
                    command: 'error',
                    text: 'Please enter a swarm name'
                });
                return;
            }

            // Generate swarm icon based on first letter
            const swarmIcon = name.charAt(0).toUpperCase();
            const swarmId = 'swarm_' + Date.now();

            // Add new swarm option to dropdown (before the separator)
            const dropdownMenu = document.getElementById('swarmDropdownMenu');
            const separator = dropdownMenu.querySelector('.swarm-dropdown-separator');
            
            const newSwarmOption = document.createElement('div');
            newSwarmOption.className = 'swarm-dropdown-option';
            newSwarmOption.setAttribute('onclick', `selectSwarm('${name}')`);
            newSwarmOption.setAttribute('data-icon', swarmIcon);
            newSwarmOption.innerHTML = `
                <span class="swarm-icon custom-icon">${swarmIcon}</span>
                <span class="swarm-name">${name}</span>
            `;

            // Insert before the separator
            dropdownMenu.insertBefore(newSwarmOption, separator);

            // Select the new swarm
            selectSwarm(name);

            // Clear form and close modal
            document.getElementById('customSwarmName').value = '';
            document.getElementById('customSwarmDescription').value = '';
            document.getElementById('customSwarmTemplate').value = 'scratch';
            closeModal('createSwarmModal');

            // Send to extension
            vscode.postMessage({
                command: 'createCustomSwarm',
                data: { 
                    id: swarmId, 
                    name: name, 
                    description: description, 
                    template: template 
                }
            });

            // Show success message
            addMessage('agent', 'System', `Custom swarm "${name}" has been created successfully! 🚀`, '✨', 'var(--gradient-secondary)');
        }

        function addCustomTool() {
            const name = document.getElementById('customToolName').value.trim();
            const description = document.getElementById('customToolDescription').value.trim();
            const category = document.getElementById('customToolCategory').value;
            const customCategoryName = document.getElementById('customCategoryName').value.trim();
            const enabled = document.getElementById('customToolStatus').value === 'true';

            if (!name) {
                vscode.postMessage({
                    command: 'error',
                    text: 'Please enter a tool name'
                });
                return;
            }

            if (!description) {
                vscode.postMessage({
                    command: 'error',
                    text: 'Please enter a tool description'
                });
                return;
            }

            // Determine final category
            let finalCategory = category;
            let categoryTitle = category.charAt(0).toUpperCase() + category.slice(1);
            let categoryIcon = '🔧'; // Default icon

            if (category === 'custom') {
                if (!customCategoryName) {
                    vscode.postMessage({
                        command: 'error',
                        text: 'Please enter a custom category name'
                    });
                    return;
                }
                finalCategory = customCategoryName.toLowerCase().replace(/\s+/g, '-');
                categoryTitle = customCategoryName;
                categoryIcon = '⚡'; // Custom category icon
            } else {
                // Set icons for predefined categories
                const categoryIcons = {
                    'development': '💻',
                    'testing': '🧪',
                    'management': '⚙️',
                    'deployment': '🚀'
                };
                categoryIcon = categoryIcons[category] || '🔧';
            }

            // Get the current agent
            const agent = agents[currentAgent];
            if (!agent) {
                vscode.postMessage({
                    command: 'error',
                    text: 'No agent selected'
                });
                return;
            }

            // Initialize toolSections if it doesn't exist
            if (!agent.toolSections) {
                agent.toolSections = {};
            }

            // Create category if it doesn't exist
            if (!agent.toolSections[finalCategory]) {
                agent.toolSections[finalCategory] = {
                    title: categoryTitle,
                    subtitle: `Custom ${categoryTitle.toLowerCase()} tools and utilities`,
                    icon: categoryIcon,
                    tools: []
                };
            }

            // Create the new tool
            const toolId = 'custom_' + Date.now();
            const newTool = {
                id: toolId,
                name: name,
                description: description,
                enabled: enabled
            };

            // Add the tool to the category
            agent.toolSections[finalCategory].tools.push(newTool);

            // Update enabled tools count
            const enabledCount = Object.values(agent.toolSections)
                .flatMap(section => section.tools)
                .filter(tool => tool.enabled).length;
            
            agent.tools = enabledCount;

            // Update the sidebar display
            updateSidebarToolsCount();

            // Refresh the tools modal content if it's open
            const toolsContent = document.getElementById('agentToolsContent');
            if (toolsContent && document.getElementById('agentToolsModal').classList.contains('active')) {
                toolsContent.innerHTML = generateToolsHTML(agent);
            }

            // Clear form and close modal
            document.getElementById('customToolName').value = '';
            document.getElementById('customToolDescription').value = '';
            document.getElementById('customToolCategory').value = 'development';
            document.getElementById('customCategoryName').value = '';
            document.getElementById('customToolStatus').value = 'false';
            document.getElementById('customCategoryGroup').style.display = 'none';
            closeModal('addToolModal');

            // Send to extension
            vscode.postMessage({
                command: 'addCustomTool',
                data: { 
                    agentId: currentAgent,
                    toolId: toolId,
                    name: name, 
                    description: description, 
                    category: finalCategory,
                    categoryTitle: categoryTitle,
                    enabled: enabled
                }
            });

            // Show success message
            addMessage('agent', 'System', `Custom tool "${name}" has been added to ${agent.name}! 🛠️`, '✨', 'var(--gradient-secondary)');
        }

        function deleteCustomTool(toolId) {
            // Get the current agent
            const agent = agents[currentAgent];
            if (!agent || !agent.toolSections) {
                return;
            }

            // Find and remove the tool
            let toolName = '';
            let categoryKey = '';
            let removed = false;

            Object.keys(agent.toolSections).forEach(sectionKey => {
                const section = agent.toolSections[sectionKey];
                const toolIndex = section.tools.findIndex(tool => tool.id === toolId);
                
                if (toolIndex !== -1) {
                    toolName = section.tools[toolIndex].name;
                    categoryKey = sectionKey;
                    section.tools.splice(toolIndex, 1);
                    removed = true;

                    // If this was the last tool in a custom category, remove the category
                    if (section.tools.length === 0 && sectionKey.startsWith('custom_')) {
                        delete agent.toolSections[sectionKey];
                    }
                }
            });

            if (!removed) {
                vscode.postMessage({
                    command: 'error',
                    text: 'Tool not found'
                });
                return;
            }

            // Update enabled tools count
            const enabledCount = Object.values(agent.toolSections)
                .flatMap(section => section.tools)
                .filter(tool => tool.enabled).length;
            
            agent.tools = enabledCount;

            // Update the sidebar display
            updateSidebarToolsCount();

            // Refresh the tools modal content if it's open
            const toolsContent = document.getElementById('agentToolsContent');
            if (toolsContent && document.getElementById('agentToolsModal').classList.contains('active')) {
                toolsContent.innerHTML = generateToolsHTML(agent);
            }

            // Send to extension
            vscode.postMessage({
                command: 'deleteCustomTool',
                data: { 
                    agentId: currentAgent,
                    toolId: toolId,
                    toolName: toolName
                }
            });

            // Show success message
            addMessage('agent', 'System', `Custom tool "${toolName}" has been removed from ${agent.name}! 🗑️`, '✨', 'var(--gradient-secondary)');
        }

        // AI Integration Functions
        function generateSwarmWithAI() {
            const projectType = document.getElementById('aiProjectType').value;
            const description = document.getElementById('aiProjectDescription').value.trim();
            const focusAreas = Array.from(document.querySelectorAll('#aiGenerateSwarmModal input[type="checkbox"]:checked'))
                .map(cb => cb.id.replace('focus-', ''));

            // Show loading state
            const statusDiv = document.getElementById('aiGenerationStatus');
            const generateBtn = document.getElementById('generateSwarmBtn');
            
            statusDiv.style.display = 'flex';
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<span class="ai-status-icon">🔄</span>Generating...';

            // Prepare AI prompt
            const prompt = `Create a specialized development swarm for a ${projectType} project. 
            ${description ? `Project description: ${description}` : ''}
            Focus areas: ${focusAreas.join(', ')}
            
            Generate:
            1. Swarm name (specific to project type)
            2. 3-5 specialized agents with roles relevant to ${projectType}
            3. For each agent, provide 2-4 tools specific to their role
            4. Brief description of the swarm's purpose
            
            Return as JSON with structure:
            {
                "name": "string",
                "description": "string", 
                "agents": [
                    {
                        "name": "string",
                        "role": "string",
                        "prompt": "string",
                        "tools": [{"name": "string", "description": "string", "category": "string"}]
                    }
                ]
            }`;

            // Send to AI API
            vscode.postMessage({
                command: 'generateSwarmWithAI',
                data: { 
                    prompt: prompt,
                    projectType: projectType,
                    description: description,
                    focusAreas: focusAreas
                }
            });
        }

        function generateToolWithAI() {
            const request = document.getElementById('aiToolRequest').value.trim();
            
            if (!request) {
                vscode.postMessage({
                    command: 'error',
                    text: 'Please describe what the tool should do'
                });
                return;
            }

            // Show loading state
            const statusDiv = document.getElementById('aiToolGenerationStatus');
            statusDiv.style.display = 'flex';

            const prompt = `Create a custom tool based on this request: "${request}"
            
            Generate:
            1. Tool name (concise, descriptive)
            2. Detailed description (what it does, how it helps)
            3. Most appropriate category (development, testing, management, deployment, or suggest custom)
            4. Implementation outline (key features/functions)
            
            Return as JSON:
            {
                "name": "string",
                "description": "string",
                "category": "string",
                "implementation": "string"
            }`;

            vscode.postMessage({
                command: 'generateToolWithAI',
                data: { 
                    prompt: prompt,
                    request: request,
                    agentId: currentAgent
                }
            });
        }

        function generateAgentWithAI() {
            const request = document.getElementById('aiAgentRequest').value.trim();
            
            if (!request) {
                vscode.postMessage({
                    command: 'error',
                    text: 'Please describe what the agent should specialize in'
                });
                return;
            }

            // Show loading state
            const statusDiv = document.getElementById('aiAgentGenerationStatus');
            statusDiv.style.display = 'flex';

            const prompt = `Create a specialized agent based on this request: "${request}"
            
            Generate:
            1. Agent name (role-specific, professional)
            2. Agent role category (development, testing, deployment, etc.)
            3. Detailed system prompt (capabilities, responsibilities, collaboration style)
            4. 3-5 relevant tools with descriptions
            
            Return as JSON:
            {
                "name": "string",
                "role": "string", 
                "systemPrompt": "string",
                "tools": [
                    {"name": "string", "description": "string", "category": "string"}
                ]
            }`;

            vscode.postMessage({
                command: 'generateAgentWithAI',
                data: { 
                    prompt: prompt,
                    request: request
                }
            });
        }

        function generateAISuggestions() {
            const refreshBtn = document.querySelector('.refresh-suggestions-btn');
            refreshBtn.style.transform = 'rotate(180deg)';
            
            setTimeout(() => {
                refreshBtn.style.transform = 'rotate(0deg)';
            }, 500);

            // Get current project context
            vscode.postMessage({
                command: 'generateAISuggestions',
                data: { 
                    context: 'current_workspace',
                    currentSwarm: document.getElementById('selectedSwarm').textContent
                }
            });
        }

        function applySuggestion(chip) {
            const suggestion = chip.textContent;
            const chatInput = document.getElementById('chatInput');
            chatInput.value = suggestion;
            chatInput.focus();
            
            // Add some visual feedback
            chip.style.background = 'var(--accent-green)';
            chip.style.color = 'white';
            setTimeout(() => {
                chip.style.background = '';
                chip.style.color = '';
            }, 300);
        }

        function toggleAIAssist() {
            const panel = document.getElementById('aiAssistPanel');
            const btn = document.getElementById('aiAssistBtn');
            
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
                btn.classList.add('active');
            } else {
                panel.style.display = 'none';
                btn.classList.remove('active');
            }
        }

        function toggleAgentAIAssist() {
            const panel = document.getElementById('agentAiAssistPanel');
            const btn = document.getElementById('agentAiAssistBtn');
            
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
                btn.classList.add('active');
            } else {
                panel.style.display = 'none';
                btn.classList.remove('active');
            }
        }

        // Handle AI responses from extension
        function handleAIResponse(response) {
            switch(response.type) {
                case 'swarmGenerated':
                    handleSwarmGenerated(response.data);
                    break;
                case 'toolGenerated':
                    handleToolGenerated(response.data);
                    break;
                case 'agentGenerated':
                    handleAgentGenerated(response.data);
                    break;
                case 'suggestionsGenerated':
                    handleSuggestionsGenerated(response.data);
                    break;
            }
        }

        function handleSwarmGenerated(data) {
            // Hide loading state
            document.getElementById('aiGenerationStatus').style.display = 'none';
            const generateBtn = document.getElementById('generateSwarmBtn');
            generateBtn.disabled = false;
            generateBtn.innerHTML = '<span class="ai-button-icon">🤖</span>Generate Swarm with AI';

            if (data.error) {
                vscode.postMessage({
                    command: 'error',
                    text: 'Failed to generate swarm: ' + data.error
                });
                return;
            }

            // Create the swarm
            const swarmData = data.swarm;
            createGeneratedSwarm(swarmData);
            
            // Close modal
            closeModal('aiGenerateSwarmModal');
            
            // Show success message
            addMessage('agent', 'AI Assistant', `🎉 Generated "${swarmData.name}" swarm with ${swarmData.agents.length} specialized agents!`, '🤖', 'var(--gradient-secondary)');
        }

        function handleToolGenerated(data) {
            // Hide loading state
            document.getElementById('aiToolGenerationStatus').style.display = 'none';

            if (data.error) {
                vscode.postMessage({
                    command: 'error',
                    text: 'Failed to generate tool: ' + data.error
                });
                return;
            }

            // Fill in the form with generated data
            const tool = data.tool;
            document.getElementById('customToolName').value = tool.name;
            document.getElementById('customToolDescription').value = tool.description;
            
            if (tool.category && tool.category !== 'custom') {
                document.getElementById('customToolCategory').value = tool.category;
            }

            // Hide AI assist panel
            toggleAIAssist();
            
            addMessage('agent', 'AI Assistant', `✨ Generated tool details for "${tool.name}"! Review and customize as needed.`, '🤖', 'var(--gradient-secondary)');
        }

        function handleAgentGenerated(data) {
            // Hide loading state
            document.getElementById('aiAgentGenerationStatus').style.display = 'none';

            if (data.error) {
                vscode.postMessage({
                    command: 'error',
                    text: 'Failed to generate agent: ' + data.error
                });
                return;
            }

            // Fill in the form with generated data
            const agent = data.agent;
            document.getElementById('newAgentName').value = agent.name;
            document.getElementById('newAgentRole').value = agent.role || 'general';
            document.getElementById('newAgentPrompt').value = agent.systemPrompt;

            // Hide AI assist panel
            toggleAgentAIAssist();
            
            addMessage('agent', 'AI Assistant', `✨ Generated agent configuration for "${agent.name}"! Review and create when ready.`, '🤖', 'var(--gradient-secondary)');
        }

        function handleSuggestionsGenerated(data) {
            if (data.error) {
                console.error('Failed to generate suggestions:', data.error);
                return;
            }

            const container = document.getElementById('suggestionsContainer');
            container.innerHTML = '';
            
            data.suggestions.forEach(suggestion => {
                const chip = document.createElement('div');
                chip.className = 'suggestion-chip';
                chip.textContent = suggestion;
                chip.onclick = () => applySuggestion(chip);
                container.appendChild(chip);
            });
        }

        function createGeneratedSwarm(swarmData) {
            // Add swarm to dropdown
            const swarmIcon = swarmData.name.charAt(0).toUpperCase();
            const dropdownMenu = document.getElementById('swarmDropdownMenu');
            const separator = dropdownMenu.querySelector('.swarm-dropdown-separator');
            
            const newSwarmOption = document.createElement('div');
            newSwarmOption.className = 'swarm-dropdown-option';
            newSwarmOption.setAttribute('onclick', `selectSwarm('${swarmData.name}')`);
            newSwarmOption.innerHTML = `
                <span class="swarm-icon custom-icon">${swarmIcon}</span>
                <span class="swarm-name">${swarmData.name}</span>
            `;

            dropdownMenu.insertBefore(newSwarmOption, separator);
            selectSwarm(swarmData.name);

            // Create agents for this swarm
            swarmData.agents.forEach((agentData, index) => {
                setTimeout(() => {
                    createAIGeneratedAgent(agentData);
                }, index * 500); // Stagger creation for visual effect
            });
        }

        function createAIGeneratedAgent(agentData) {
            const agentId = 'ai_agent_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            const avatar = agentData.name.charAt(0).toUpperCase();
            const gradients = [
                'var(--gradient-primary)',
                'var(--gradient-secondary)', 
                'linear-gradient(135deg, var(--accent-purple), var(--accent-red))',
                'linear-gradient(135deg, var(--accent-orange), var(--accent-red))',
                'linear-gradient(135deg, var(--accent-green), var(--accent-blue))'
            ];
            const randomGradient = gradients[Math.floor(Math.random() * gradients.length)];

            // Create tools structure
            const toolSections = {};
            agentData.tools.forEach(tool => {
                const category = tool.category || 'development';
                if (!toolSections[category]) {
                    const categoryIcons = {
                        'development': '💻',
                        'testing': '🧪', 
                        'management': '⚙️',
                        'deployment': '🚀',
                        'security': '🔒',
                        'monitoring': '📊'
                    };
                    
                    toolSections[category] = {
                        title: category.charAt(0).toUpperCase() + category.slice(1),
                        subtitle: `${category.charAt(0).toUpperCase() + category.slice(1)} tools and utilities`,
                        icon: categoryIcons[category] || '🔧',
                        tools: []
                    };
                }
                
                toolSections[category].tools.push({
                    id: 'ai_tool_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    name: tool.name,
                    description: tool.description,
                    enabled: true
                });
            });

            // Create agent object
            agents[agentId] = {
                name: agentData.name,
                avatar: avatar,
                gradient: randomGradient,
                tools: agentData.tools.length,
                enabledTools: agentData.tools.map(t => t.name.toLowerCase().replace(/\s+/g, '-')),
                toolSections: toolSections,
                config: {
                    systemPrompt: agentData.prompt || agentData.systemPrompt,
                    llmProvider: 'openai-gpt4',
                    responseTimeout: 5000,
                    maxConcurrentTasks: 3,
                    memoryManagement: 'auto'
                }
            };

            // Add to sidebar
            const agentsList = document.getElementById('agentsList');
            const newAgentCard = document.createElement('div');
            newAgentCard.className = 'agent-card';
            newAgentCard.setAttribute('data-agent', agentId);
            newAgentCard.innerHTML = `
                <div class="agent-header" onclick="selectAgent(this.parentElement, '${agentId}')">
                    <div class="agent-name">
                        <div class="agent-avatar" style="background: ${randomGradient};">${avatar}</div>
                        <span>${agentData.name}</span>
                    </div>
                    <div class="agent-status active"></div>
                </div>
                <div class="agent-tools">${agentData.tools.length} tools enabled</div>
                <div class="agent-actions">
                    <button class="agent-action-btn" onclick="openAgentConfig('${agentId}')" title="Configuration">
                        <span>⚙️</span>
                        <span>Config</span>
                    </button>
                    <button class="agent-action-btn" onclick="openAgentTools('${agentId}')" title="Tools">
                        <span>🛠️</span>
                        <span>Tools</span>
                    </button>
                </div>
            `;

            agentsList.appendChild(newAgentCard);
            updateChatHeader();
        }

        // Code Context Functions
        let hasCodeContext = false;

        function addCodeContext() {
            const btn = document.getElementById('aiContextBtn');
            const indicator = document.getElementById('chatContextIndicator');
            
            if (!hasCodeContext) {
                // Request current file context from extension
                vscode.postMessage({
                    command: 'getCodeContext',
                    data: {}
                });
                
                btn.classList.add('active');
                indicator.style.display = 'flex';
                hasCodeContext = true;
            }
        }

        function removeCodeContext() {
            const btn = document.getElementById('aiContextBtn');
            const indicator = document.getElementById('chatContextIndicator');
            
            btn.classList.remove('active');
            indicator.style.display = 'none';
            hasCodeContext = false;
        }

        function enhancedSendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;

            // Include code context if enabled
            const messageData = {
                message: message,
                includeContext: hasCodeContext,
                timestamp: new Date().toISOString()
            };

            // Send enhanced message
            vscode.postMessage({
                command: 'sendEnhancedMessage',
                data: messageData
            });

            // Add message to chat
            addMessage('user', 'You', message, '🧑‍💻', 'var(--user-message-gradient)');
            
            input.value = '';
            autoResizeTextarea(input);
        }

        // REMOVED: Update the original sendMessage to use enhanced version
        // Our sendMessage function should trigger the Python demo directly

        function handleCodeContextReceived(data) {
            if (data.context) {
                console.log('Code context received:', data.context);
                // Context is now available for enhanced messaging
            } else {
                console.log('No code context available:', data.message);
                removeCodeContext();
            }
        }

        function handleAIChatResponse(data) {
            // Add AI response to chat
            addMessage('agent', 'AI Assistant', data.response, '🤖', 'var(--gradient-secondary)');
        }

        // Swarm dropdown functionality
        function toggleSwarmDropdown() {
            // Don't open dropdown if sidebar is collapsed
            if (sidebarCollapsed) {
                return;
            }
            
            const menu = document.getElementById('swarmDropdownMenu');
            const arrow = document.querySelector('.dropdown-arrow');
            const swarmDropdown = document.querySelector('.swarm-dropdown');
            const isVisible = menu.classList.contains('show');
            
            // Close all other dropdowns first
            document.querySelectorAll('.swarm-dropdown-menu.show').forEach(dropdown => {
                dropdown.classList.remove('show');
            });
            
            // Reset all arrows
            document.querySelectorAll('.dropdown-arrow').forEach(arrow => {
                arrow.style.transform = 'rotate(0deg)';
            });
            
            // Toggle current dropdown
            if (!isVisible) {
                // Calculate position for fixed dropdown
                const rect = swarmDropdown.getBoundingClientRect();
                menu.style.top = (rect.bottom + 4) + 'px';
                menu.style.left = rect.left + 'px';
                menu.style.width = rect.width + 'px';
                
                menu.classList.add('show');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        function closeSwarmDropdown() {
            const menu = document.getElementById('swarmDropdownMenu');
            const arrow = document.querySelector('.dropdown-arrow');
            
            menu.classList.remove('show');
            arrow.style.transform = 'rotate(0deg)';
        }

        function selectSwarm(swarmName) {
            const selectedElement = document.getElementById('selectedSwarm');
            
            // Get the icon and class for the selected swarm
            const swarmConfig = {
                'FlutterSwarm': { icon: 'F', class: 'flutter-icon' },
                'WebDevSwarm': { icon: 'W', class: 'web-icon' },
                'MobileSwarm': { icon: 'M', class: 'mobile-icon' },
                'AISwarm': { icon: 'A', class: 'ai-icon' },
                'DataSwarm': { icon: 'D', class: 'data-icon' },
                'PythonSwarm': { icon: 'P', class: 'python-icon' }
            };
            
            const config = swarmConfig[swarmName] || { 
                icon: swarmName.charAt(0).toUpperCase(), 
                class: 'custom-icon' 
            };
            selectedElement.innerHTML = `<span class="swarm-icon ${config.class}" style="margin-right: 8px; width: 20px; height: 20px; font-size: 12px;">${config.icon}</span>${swarmName}`;
            
            // Update selected option
            document.querySelectorAll('.swarm-dropdown-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Find the clicked option by checking the swarm name
            const clickedOption = Array.from(document.querySelectorAll('.swarm-dropdown-option')).find(option => {
                return option.querySelector('.swarm-name').textContent === swarmName;
            });
            
            if (clickedOption) {
                clickedOption.classList.add('selected');
            }
            
            // Close dropdown
            document.getElementById('swarmDropdownMenu').classList.remove('show');
            
            // Update current swarm and render agents
            currentSwarm = swarmName;
            renderAgentsForSwarm(swarmName);
            
            // Switch collaboration settings to this swarm
            switchSwarmCollaboration(swarmName);
            
            console.log('Selected swarm:', swarmName);
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.swarm-selector')) {
                document.querySelectorAll('.swarm-dropdown-menu.show').forEach(dropdown => {
                    dropdown.classList.remove('show');
                });
                // Reset all arrows
                document.querySelectorAll('.dropdown-arrow').forEach(arrow => {
                    arrow.style.transform = 'rotate(0deg)';
                });
            }
        });

        // Close modals when clicking outside
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Escape to close modals
            if (event.key === 'Escape') {
                document.querySelectorAll('.modal.active').forEach(function(modal) {
                    modal.classList.remove('active');
                });
            }
            
            // Ctrl/Cmd + / to focus chat input
            if ((event.ctrlKey || event.metaKey) && event.key === '/') {
                event.preventDefault();
                document.getElementById('chatInput').focus();
            }
        });

        // Theme Toggle Functions
        let currentTheme = 'light';

        // Set theme to system default automatically
        function initializeTheme() {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            document.body.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
            
            // Listen for system theme changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                document.body.setAttribute('data-theme', e.matches ? 'dark' : 'light');
            });
        }

        // Initialize with system theme
        initializeTheme();

        // Clear activity logs function
        function clearLogs() {
            const activityLogs = document.getElementById('activityLogs');
            if (activityLogs && confirm('Clear all activity logs?')) {
                activityLogs.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-muted); font-size: 12px;">No recent activity</div>';
            }
        }

        // Add new activity log entry
        function addLogEntry(agent, content, status, statusClass) {
            const activityLogs = document.getElementById('activityLogs');
            if (!activityLogs) return;

            // Remove "no activity" message if present
            if (activityLogs.innerHTML.includes('No recent activity')) {
                activityLogs.innerHTML = '';
            }

            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            const agentInfo = agents[agent] || { avatar: '🤖', gradient: 'var(--gradient-primary)', name: agent };
            const currentTime = new Date();
            const timeStr = currentTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            logEntry.innerHTML = `
                <div class="log-header">
                    <div class="log-avatar" style="background: ${agentInfo.gradient};">${agentInfo.avatar}</div>
                    <div class="log-info">
                        <span class="log-agent">${agentInfo.name}</span>
                        <span class="log-time">Just now</span>
                    </div>
                </div>
                <div class="log-content">${content}</div>
                <div class="log-status ${statusClass}">${status}</div>
            `;
            
            // Insert at the top
            activityLogs.insertBefore(logEntry, activityLogs.firstChild);
            
            // Keep only the last 10 entries
            while (activityLogs.children.length > 10) {
                activityLogs.removeChild(activityLogs.lastChild);
            }
        }

        // Global Collaboration Functions - Now Swarm-Specific
        let swarmCollaborationRules = {
            'PythonSwarm': `Orchestrator Agent: Coordinates all project activities, delegates tasks to specialized agents, monitors progress, and consolidates final results.

Python Developer: Implements backend logic, database models, APIs, and server-side functionality. Reports progress to Orchestrator.

Frontend Developer: Creates user interfaces, implements responsive design, and integrates with backend APIs. Coordinates with Python Developer for seamless integration.

QA Tester: Validates all implementations, runs comprehensive test suites, identifies issues, and ensures quality standards. Reports findings to development team and Orchestrator.`,
            
            'WebDevSwarm': `Orchestrator Agent: Manages web development projects, coordinates between frontend/backend teams, and oversees deployment processes.

CI/CD Agent: Handles automated builds, testing pipelines, and deployment strategies. Coordinates with Tests Agent for quality assurance.

Tests Agent: Performs comprehensive testing including unit tests, integration tests, and automated browser testing.

Writer Agent: Creates technical documentation, user guides, and content for web applications.`,

            'FlutterSwarm': `Orchestrator Agent: Coordinates mobile app development lifecycle from planning to deployment.

CI/CD Agent: Manages Flutter build processes, handles app store deployments, and maintains CI/CD pipelines.

Tests Agent: Performs mobile testing including widget tests, integration tests, and device compatibility testing.`,

            'MobileSwarm': `Orchestrator Agent: Oversees mobile development across platforms, manages project timelines and resource allocation.

CI/CD Agent: Handles mobile CI/CD pipelines, manages app store submissions, and coordinates releases.

Tests Agent: Conducts mobile-specific testing including performance testing, battery optimization, and cross-device compatibility.`,

            'AISwarm': `Orchestrator Agent: Coordinates AI/ML project development, manages model training workflows, and oversees deployment.

CI/CD Agent: Handles MLOps pipelines, model versioning, and automated deployment of AI services.

Tests Agent: Performs model validation, A/B testing, and quality assurance for AI systems.`,

            'DataSwarm': `Orchestrator Agent: Manages data engineering projects, coordinates ETL pipelines, and oversees data quality initiatives.

CI/CD Agent: Handles data pipeline deployments, manages infrastructure, and coordinates data releases.

Tests Agent: Performs data validation, quality checks, and testing of data processing workflows.`
        };

        let currentSwarmForCollab = 'PythonSwarm';
        let collaborationSectionCollapsed = false;
        let activityLogsSectionCollapsed = false;

        function updateSwarmCollaboration(value) {
            swarmCollaborationRules[currentSwarmForCollab] = value;
            console.log(`Swarm collaboration rules updated for ${currentSwarmForCollab}:`, value);
        }

        function saveSwarmCollaborationRules() {
            const textarea = document.getElementById('globalCollaborationRules');
            swarmCollaborationRules[currentSwarmForCollab] = textarea.value;
            
            // Show success message
            vscode.postMessage({
                command: 'saveSwarmCollaboration',
                data: { 
                    swarm: currentSwarmForCollab,
                    rules: swarmCollaborationRules[currentSwarmForCollab] 
                }
            });
            
            // Visual feedback
            const saveBtn = event.target;
            const originalText = saveBtn.textContent;
            saveBtn.textContent = 'Saved!';
            saveBtn.style.background = 'var(--accent-green)';
            
            setTimeout(() => {
                saveBtn.textContent = originalText;
                saveBtn.style.background = 'var(--accent-blue)';
            }, 2000);
            
            console.log(`Collaboration rules saved for ${currentSwarmForCollab}:`, swarmCollaborationRules[currentSwarmForCollab]);
        }

        function resetSwarmCollaborationRules() {
            // Get default rules for current swarm
            const defaultRules = getDefaultCollaborationRules(currentSwarmForCollab);
            
            document.getElementById('globalCollaborationRules').value = defaultRules;
            swarmCollaborationRules[currentSwarmForCollab] = defaultRules;
            
            console.log(`Collaboration rules reset to default for ${currentSwarmForCollab}`);
        }

        function getDefaultCollaborationRules(swarmName) {
            const defaults = {
                'PythonSwarm': `Orchestrator Agent: Coordinates all project activities, delegates tasks to specialized agents, monitors progress, and consolidates final results.

Python Developer: Implements backend logic, database models, APIs, and server-side functionality. Reports progress to Orchestrator.

Frontend Developer: Creates user interfaces, implements responsive design, and integrates with backend APIs. Coordinates with Python Developer for seamless integration.

QA Tester: Validates all implementations, runs comprehensive test suites, identifies issues, and ensures quality standards. Reports findings to development team and Orchestrator.`,
                
                'WebDevSwarm': `Orchestrator Agent: Manages web development projects, coordinates between frontend/backend teams, and oversees deployment processes.

CI/CD Agent: Handles automated builds, testing pipelines, and deployment strategies. Coordinates with Tests Agent for quality assurance.

Tests Agent: Performs comprehensive testing including unit tests, integration tests, and automated browser testing.

Writer Agent: Creates technical documentation, user guides, and content for web applications.`,

                'FlutterSwarm': `Orchestrator Agent: Coordinates mobile app development lifecycle from planning to deployment.

CI/CD Agent: Manages Flutter build processes, handles app store deployments, and maintains CI/CD pipelines.

Tests Agent: Performs mobile testing including widget tests, integration tests, and device compatibility testing.`,

                'MobileSwarm': `Orchestrator Agent: Oversees mobile development across platforms, manages project timelines and resource allocation.

CI/CD Agent: Handles mobile CI/CD pipelines, manages app store submissions, and coordinates releases.

Tests Agent: Conducts mobile-specific testing including performance testing, battery optimization, and cross-device compatibility.`,

                'AISwarm': `Orchestrator Agent: Coordinates AI/ML project development, manages model training workflows, and oversees deployment.

CI/CD Agent: Handles MLOps pipelines, model versioning, and automated deployment of AI services.

Tests Agent: Performs model validation, A/B testing, and quality assurance for AI systems.`,

                'DataSwarm': `Orchestrator Agent: Manages data engineering projects, coordinates ETL pipelines, and oversees data quality initiatives.

CI/CD Agent: Handles data pipeline deployments, manages infrastructure, and coordinates data releases.

Tests Agent: Performs data validation, quality checks, and testing of data processing workflows.`
            };
            
            return defaults[swarmName] || defaults['PythonSwarm'];
        }

        function switchSwarmCollaboration(swarmName) {
            // Save current swarm's rules
            const textarea = document.getElementById('globalCollaborationRules');
            if (textarea.value) {
                swarmCollaborationRules[currentSwarmForCollab] = textarea.value;
            }
            
            // Switch to new swarm
            currentSwarmForCollab = swarmName;
            
            // Update UI
            document.getElementById('currentSwarmCollabName').textContent = swarmName;
            
            // Load rules for new swarm
            const rules = swarmCollaborationRules[swarmName] || getDefaultCollaborationRules(swarmName);
            textarea.value = rules;
            
            console.log(`Switched collaboration to ${swarmName}`);
        }

        function toggleCollaborationSection() {
            const content = document.getElementById('collaborationContent');
            const icon = document.getElementById('collabToggleIcon');
            
            collaborationSectionCollapsed = !collaborationSectionCollapsed;
            
            if (collaborationSectionCollapsed) {
                content.classList.add('collapsed');
                icon.textContent = '▶';
            } else {
                content.classList.remove('collapsed');
                icon.textContent = '▼';
            }
        }

        function toggleActivityLogsSection() {
            const activityLogs = document.getElementById('activityLogs');
            const icon = document.getElementById('activityToggleIcon');
            
            activityLogsSectionCollapsed = !activityLogsSectionCollapsed;
            
            if (activityLogsSectionCollapsed) {
                activityLogs.classList.add('collapsed');
                icon.textContent = '▶';
            } else {
                activityLogs.classList.remove('collapsed');
                icon.textContent = '▼';
            }
        }

        function getGlobalCollaborationRules() {
            return swarmCollaborationRules[currentSwarmForCollab] || getDefaultCollaborationRules(currentSwarmForCollab);
        }
    </script>
</body>
</html>